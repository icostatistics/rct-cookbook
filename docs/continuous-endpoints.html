<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Continuous endpoints | Analyzing RCTs: A Cookbook</title>
  <meta name="description" content="The idea of this book is to capture some of the standard statistical analysis methods for randomised controlled trials" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Continuous endpoints | Analyzing RCTs: A Cookbook" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="The idea of this book is to capture some of the standard statistical analysis methods for randomised controlled trials" />
  <meta name="github-repo" content="icostatistics/rct-cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Continuous endpoints | Analyzing RCTs: A Cookbook" />
  
  <meta name="twitter:description" content="The idea of this book is to capture some of the standard statistical analysis methods for randomised controlled trials" />
  

<meta name="author" content="Inge Christoffer Olsen" />


<meta name="date" content="2024-11-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="dichotomous-endpoints.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#structure-of-the-book"><i class="fa fa-check"></i><b>1.1</b> Structure of the book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.2</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#trial-flow"><i class="fa fa-check"></i><b>2.1</b> Trial Flow</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#simulated-dataset"><i class="fa fa-check"></i><b>2.2</b> Simulated dataset</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html"><i class="fa fa-check"></i><b>3</b> Continuous endpoints</a>
<ul>
<li class="chapter" data-level="3.1" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#single-follow-up"><i class="fa fa-check"></i><b>3.1</b> Single follow-up</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#stata-code"><i class="fa fa-check"></i><b>3.1.1</b> Stata code</a></li>
<li class="chapter" data-level="3.1.2" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#r-code"><i class="fa fa-check"></i><b>3.1.2</b> R code</a></li>
<li class="chapter" data-level="3.1.3" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#reporting"><i class="fa fa-check"></i><b>3.1.3</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#repeated-follow-up"><i class="fa fa-check"></i><b>3.2</b> Repeated follow-up</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#simple-model"><i class="fa fa-check"></i><b>3.2.1</b> Simple model</a></li>
<li class="chapter" data-level="3.2.2" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#model-with-treatment-time-interaction"><i class="fa fa-check"></i><b>3.2.2</b> Model with treatment-time interaction</a></li>
<li class="chapter" data-level="3.2.3" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#model-with-treatment-time-interaction-and-baseline-information"><i class="fa fa-check"></i><b>3.2.3</b> Model with treatment-time interaction and baseline information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html"><i class="fa fa-check"></i><b>4</b> Dichotomous endpoints</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html#single-follow-up-1"><i class="fa fa-check"></i><b>4.1</b> Single follow-up</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html#stata-code-1"><i class="fa fa-check"></i><b>4.1.1</b> Stata code</a></li>
<li class="chapter" data-level="4.1.2" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html#r-code-1"><i class="fa fa-check"></i><b>4.1.2</b> R code</a></li>
<li class="chapter" data-level="4.1.3" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html#reporting-1"><i class="fa fa-check"></i><b>4.1.3</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html#repeated-follow-up-1"><i class="fa fa-check"></i><b>4.2</b> Repeated follow-up</a></li>
<li class="chapter" data-level="4.3" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html#treatment-time-interaction-model"><i class="fa fa-check"></i><b>4.3</b> Treatment-time interaction model</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html#reporting-2"><i class="fa fa-check"></i><b>4.3.1</b> Reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="time-to-event-analyses.html"><a href="time-to-event-analyses.html"><i class="fa fa-check"></i><b>5</b> Time to event analyses</a></li>
<li class="chapter" data-level="6" data-path="sample-size-calculations.html"><a href="sample-size-calculations.html"><i class="fa fa-check"></i><b>6</b> Sample size calculations</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analyzing RCTs: A Cookbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="continuous-endpoints" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Continuous endpoints<a href="continuous-endpoints.html#continuous-endpoints" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="single-follow-up" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Single follow-up<a href="continuous-endpoints.html#single-follow-up" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When the outcome consists of a single follow-up assessment of the continuous endpoint, the main method I use is Analysis of Covariance. According to the EMAs <a href="http://www.ema.europa.eu/docs/en_GB/document_library/Scientific_guideline/2015/03/WC500184923.pdf">Guideline on adjustment for baseline covariates in clinical trials</a> we should adjust for site in multicentre trial, any stratification factors in the randomisation in addition to pre-specified covariates with evidence of strong or moderate association between the covariate and the primary outcome measure. Usually this also means the baseline observation of the outcome. In our simulated data set this means to adjust for <code>site</code>, <code>contbl</code> and <code>covar</code> variables. In this example we define that the primary outcome is the continuous outcome at time 3.</p>
<div id="stata-code" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Stata code<a href="continuous-endpoints.html#stata-code" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb4-1"><a href="continuous-endpoints.html#cb4-1" tabindex="-1"></a></span>
<span id="cb4-2"><a href="continuous-endpoints.html#cb4-2" tabindex="-1"></a><span class="kw">use</span> stata/rct, <span class="kw">clear</span> </span>
<span id="cb4-3"><a href="continuous-endpoints.html#cb4-3" tabindex="-1"></a><span class="kw">regress</span> contout i.trt i.site covar contbl <span class="kw">if</span> time==3</span></code></pre></div>
<pre><code>(all strata combined)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(6, 91)        =     67.55
       Model |  454.530038         6  75.7550064   Prob &gt; F        =    0.0000
    Residual |  102.049964        91  1.12142818   R-squared       =    0.8166
-------------+----------------------------------   Adj R-squared   =    0.8046
       Total |  556.580002        97  5.73793817   Root MSE        =     1.059

------------------------------------------------------------------------------
     contout | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         trt |
     Active  |  -2.768593   .2162162   -12.80   0.000    -3.198079   -2.339106
             |
        site |
          2  |   .0464146   .3171924     0.15   0.884    -.5836491    .6764783
          3  |    .194252   .2832692     0.69   0.495    -.3684276    .7569315
          4  |   .7040756   .3356689     2.10   0.039     .0373106    1.370841
             |
       covar |   .5580744   .0882877     6.32   0.000     .3827017    .7334471
      contbl |   .3812488   .0813377     4.69   0.000     .2196815    .5428161
       _cons |   12.60568   1.165712    10.81   0.000     10.29013    14.92122
------------------------------------------------------------------------------</code></pre>
<p>Note that we here looked at the outcome at time 3 as the primary outcome. It does not matter if we use this or the change from baseline to time 3, due to the baseline adjustment:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb6-1"><a href="continuous-endpoints.html#cb6-1" tabindex="-1"></a><span class="kw">use</span> stata/rct, <span class="kw">clear</span> </span>
<span id="cb6-2"><a href="continuous-endpoints.html#cb6-2" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">diff</span> = contout - contbl </span>
<span id="cb6-3"><a href="continuous-endpoints.html#cb6-3" tabindex="-1"></a><span class="kw">regress</span> <span class="fu">diff</span> i.trt i.site covar contbl <span class="kw">if</span> time==3</span></code></pre></div>
<pre><code>(all strata combined)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(6, 91)        =     40.55
       Model |  272.859876         6   45.476646   Prob &gt; F        =    0.0000
    Residual |  102.049964        91  1.12142818   R-squared       =    0.7278
-------------+----------------------------------   Adj R-squared   =    0.7099
       Total |   374.90984        97   3.8650499   Root MSE        =     1.059

------------------------------------------------------------------------------
        diff | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         trt |
     Active  |  -2.768593   .2162162   -12.80   0.000    -3.198079   -2.339106
             |
        site |
          2  |   .0464146   .3171924     0.15   0.884    -.5836491    .6764783
          3  |    .194252   .2832692     0.69   0.495    -.3684276    .7569315
          4  |   .7040756   .3356689     2.10   0.039     .0373106    1.370841
             |
       covar |   .5580744   .0882877     6.32   0.000     .3827017    .7334471
      contbl |  -.6187512   .0813377    -7.61   0.000    -.7803185   -.4571839
       _cons |   12.60568   1.165712    10.81   0.000     10.29013    14.92122
------------------------------------------------------------------------------</code></pre>
<p>We see that the only difference is that the baseline parameter estimate shifts with one unit.</p>
</div>
<div id="r-code" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> R code<a href="continuous-endpoints.html#r-code" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="continuous-endpoints.html#cb8-1" tabindex="-1"></a>rct <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">&quot;stata/rct.dta&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="continuous-endpoints.html#cb8-2" tabindex="-1"></a>  <span class="fu">modify_at</span>(<span class="fu">c</span>(<span class="st">&quot;trt&quot;</span>,<span class="st">&quot;catout&quot;</span>), haven<span class="sc">::</span>as_factor, <span class="at">levels =</span> <span class="st">&quot;labels&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="continuous-endpoints.html#cb8-3" tabindex="-1"></a>  <span class="fu">modify_at</span>(<span class="fu">c</span>(<span class="st">&quot;site&quot;</span>,<span class="st">&quot;time&quot;</span>), haven<span class="sc">::</span>as_factor)</span>
<span id="cb8-4"><a href="continuous-endpoints.html#cb8-4" tabindex="-1"></a>rct <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="continuous-endpoints.html#cb8-5" tabindex="-1"></a>  <span class="fu">filter</span>(time<span class="sc">==</span><span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="continuous-endpoints.html#cb8-6" tabindex="-1"></a>  <span class="fu">lm</span>(contout <span class="sc">~</span> trt <span class="sc">+</span> site <span class="sc">+</span> covar <span class="sc">+</span> contbl, <span class="at">data=</span>.) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="continuous-endpoints.html#cb8-7" tabindex="-1"></a>  summary</span></code></pre></div>
<pre><code>
Call:
lm(formula = contout ~ trt + site + covar + contbl, data = .)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.35594 -0.68326  0.00278  0.73595  1.98465 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 12.60568    1.16571  10.814  &lt; 2e-16 ***
trtActive   -2.76859    0.21622 -12.805  &lt; 2e-16 ***
site2        0.04641    0.31719   0.146   0.8840    
site3        0.19425    0.28327   0.686   0.4946    
site4        0.70408    0.33567   2.098   0.0387 *  
covar        0.55807    0.08829   6.321 9.46e-09 ***
contbl       0.38125    0.08134   4.687 9.68e-06 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 1.059 on 91 degrees of freedom
Multiple R-squared:  0.8166,    Adjusted R-squared:  0.8046 
F-statistic: 67.55 on 6 and 91 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>We see that the parameter estimates are identical.</p>
</div>
<div id="reporting" class="section level3 hasAnchor" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Reporting<a href="continuous-endpoints.html#reporting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>According to the <a href="consort-statement.org">CONSORT Statement</a> item 17a:
&gt; For each outcome, study results should be reported as a summary of the outcome in each group (for example, the number of participants with or without the event and the denominators, or the mean and standard deviation of measurements), together with the contrast between the groups, known as the effect size.</p>
<p>For the single follow-up we present the mean and standard deviaiton for the outcome in addition to the effect size at follow-up (time 3). There is some coding to get the format right, but the nice thing is that the table could be pasted directly into the article. There are many ways to program this, the below example is one way.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="continuous-endpoints.html#cb10-1" tabindex="-1"></a><span class="co">#Two functions to produce the mean (sd) and est (lci to uci) output--------------------</span></span>
<span id="cb10-2"><a href="continuous-endpoints.html#cb10-2" tabindex="-1"></a>get_meansd <span class="ot">&lt;-</span> <span class="cf">function</span>(m, s, <span class="at">d=</span><span class="dv">2</span>){</span>
<span id="cb10-3"><a href="continuous-endpoints.html#cb10-3" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">round</span>(m, <span class="at">digits=</span>d),<span class="st">&quot; (&quot;</span>,<span class="fu">round</span>(s,<span class="at">digits=</span>d),<span class="st">&quot;)&quot;</span>)</span>
<span id="cb10-4"><a href="continuous-endpoints.html#cb10-4" tabindex="-1"></a>}</span>
<span id="cb10-5"><a href="continuous-endpoints.html#cb10-5" tabindex="-1"></a>get_estci <span class="ot">&lt;-</span> <span class="cf">function</span>(e, l, u, <span class="at">d=</span><span class="dv">2</span>){</span>
<span id="cb10-6"><a href="continuous-endpoints.html#cb10-6" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">round</span>(e, <span class="at">digits=</span>d), <span class="st">&quot; (&quot;</span>, <span class="fu">round</span>(l, <span class="at">digits=</span>d), <span class="st">&quot; to &quot;</span>, <span class="fu">round</span>(u, <span class="at">digits=</span>d),<span class="st">&quot;)&quot;</span>)</span>
<span id="cb10-7"><a href="continuous-endpoints.html#cb10-7" tabindex="-1"></a>}</span>
<span id="cb10-8"><a href="continuous-endpoints.html#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="continuous-endpoints.html#cb10-9" tabindex="-1"></a><span class="co"># Compile the summary measures---------------------------------------------------------</span></span>
<span id="cb10-10"><a href="continuous-endpoints.html#cb10-10" tabindex="-1"></a>single_cont_sum <span class="ot">&lt;-</span> rct <span class="sc">%&gt;%</span> </span>
<span id="cb10-11"><a href="continuous-endpoints.html#cb10-11" tabindex="-1"></a>  <span class="fu">group_by</span>(trt) <span class="sc">%&gt;%</span> </span>
<span id="cb10-12"><a href="continuous-endpoints.html#cb10-12" tabindex="-1"></a>  <span class="fu">filter</span>(time<span class="sc">==</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-13"><a href="continuous-endpoints.html#cb10-13" tabindex="-1"></a>  <span class="fu">select</span>(contout, trt) <span class="sc">%&gt;%</span> </span>
<span id="cb10-14"><a href="continuous-endpoints.html#cb10-14" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="fu">list</span>(<span class="sc">~</span><span class="fu">mean</span>(.),<span class="sc">~</span><span class="fu">sd</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-15"><a href="continuous-endpoints.html#cb10-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">txt1=</span><span class="fu">get_meansd</span>(mean,sd)) <span class="sc">%&gt;%</span></span>
<span id="cb10-16"><a href="continuous-endpoints.html#cb10-16" tabindex="-1"></a>  <span class="fu">select</span>(trt,txt1) <span class="sc">%&gt;%</span></span>
<span id="cb10-17"><a href="continuous-endpoints.html#cb10-17" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key=</span>trt,<span class="at">value=</span>txt1)</span>
<span id="cb10-18"><a href="continuous-endpoints.html#cb10-18" tabindex="-1"></a></span>
<span id="cb10-19"><a href="continuous-endpoints.html#cb10-19" tabindex="-1"></a><span class="co"># Compile the estimates --------------------------------------------------------------</span></span>
<span id="cb10-20"><a href="continuous-endpoints.html#cb10-20" tabindex="-1"></a>single_cont_est <span class="ot">&lt;-</span> rct <span class="sc">%&gt;%</span> </span>
<span id="cb10-21"><a href="continuous-endpoints.html#cb10-21" tabindex="-1"></a>  <span class="fu">filter</span>(time<span class="sc">==</span><span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-22"><a href="continuous-endpoints.html#cb10-22" tabindex="-1"></a>  <span class="fu">lm</span>(contout <span class="sc">~</span> trt <span class="sc">+</span> site <span class="sc">+</span> covar <span class="sc">+</span> contbl, <span class="at">data=</span>.) <span class="sc">%&gt;%</span></span>
<span id="cb10-23"><a href="continuous-endpoints.html#cb10-23" tabindex="-1"></a>  <span class="fu">tidy</span>(<span class="at">conf.int=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-24"><a href="continuous-endpoints.html#cb10-24" tabindex="-1"></a>  <span class="fu">filter</span>(term<span class="sc">==</span><span class="st">&quot;trtActive&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-25"><a href="continuous-endpoints.html#cb10-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">txt2=</span><span class="fu">get_estci</span>(estimate,conf.low,conf.high)) <span class="sc">%&gt;%</span></span>
<span id="cb10-26"><a href="continuous-endpoints.html#cb10-26" tabindex="-1"></a>  <span class="fu">select</span>(term,txt2)</span>
<span id="cb10-27"><a href="continuous-endpoints.html#cb10-27" tabindex="-1"></a></span>
<span id="cb10-28"><a href="continuous-endpoints.html#cb10-28" tabindex="-1"></a><span class="co"># Combine and produce the table -----------------------------------------------------</span></span>
<span id="cb10-29"><a href="continuous-endpoints.html#cb10-29" tabindex="-1"></a>single_cont_sum <span class="sc">%&gt;%</span> </span>
<span id="cb10-30"><a href="continuous-endpoints.html#cb10-30" tabindex="-1"></a>  <span class="fu">bind_cols</span>(single_cont_est) <span class="sc">%&gt;%</span></span>
<span id="cb10-31"><a href="continuous-endpoints.html#cb10-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">txt=</span><span class="st">&quot;Outcome at time 3, mean (sd)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-32"><a href="continuous-endpoints.html#cb10-32" tabindex="-1"></a>  <span class="fu">select</span>(txt,Active, Placebo, txt2) <span class="sc">%&gt;%</span> </span>
<span id="cb10-33"><a href="continuous-endpoints.html#cb10-33" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names=</span><span class="fu">c</span>(<span class="st">&quot;Outcome&quot;</span>, <span class="st">&quot;Active&quot;</span>, <span class="st">&quot;Placebo&quot;</span>, <span class="st">&quot;Effect size with 95% confidence limits&quot;</span>))</span></code></pre></div>
<table>
<colgroup>
<col width="29%" />
<col width="16%" />
<col width="15%" />
<col width="39%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Outcome</th>
<th align="left">Active</th>
<th align="left">Placebo</th>
<th align="left">Effect size with 95% confidence limits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Outcome at time 3, mean (sd)</td>
<td align="left">19.88 ( 2.05 )</td>
<td align="left">22.3 ( 2.09 )</td>
<td align="left">-2.77 ( -3.2 to -2.34 )</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="repeated-follow-up" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Repeated follow-up<a href="continuous-endpoints.html#repeated-follow-up" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When the measurements are repeated, I usually use mixed models to model the data. The challenge with mixed models is that the effect size can be estimated in several ways, depending on the model specification.</p>
<div id="simple-model" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Simple model<a href="continuous-endpoints.html#simple-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The simplest model is a model with random intercept and treatment, time and other baseline covariates as fixed effects.</p>
<p><span class="math display">\[ Y_{ij} =  \mu_j + A_i + \mu_{trt} + \mu_{strat} + a_1 X_1 +  \epsilon_{ij} \]</span></p>
<p>where <span class="math inline">\(Y_{ij}\)</span> is the contiuous outcome for individual <span class="math inline">\(i\)</span> at time <span class="math inline">\(j\)</span>, <span class="math inline">\(\mu_j\)</span> is the overall mean at time <span class="math inline">\(j\)</span>, <span class="math inline">\(A_i\)</span> is the random intercept for individual <span class="math inline">\(i\)</span>, <span class="math inline">\(\mu_{trt}\)</span> is the mean treatment effect, <span class="math inline">\(\mu_{strat}\)</span> is the mean effect of strata, <span class="math inline">\(a_1\)</span> is the slope parameter of baseline covariate <span class="math inline">\(X_1\)</span>, and <span class="math inline">\(\epsilon_{ij}\)</span> is the residual. The expression is sloppy, but should be readable.</p>
<p>In Stata, this model is coded as</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb11-1"><a href="continuous-endpoints.html#cb11-1" tabindex="-1"></a><span class="kw">use</span> stata/rct, <span class="kw">clear</span> </span>
<span id="cb11-2"><a href="continuous-endpoints.html#cb11-2" tabindex="-1"></a>mixed contout i.trt i.site i.time covar || pid: </span></code></pre></div>
<pre><code>(all strata combined)


Performing EM optimization ...

Performing gradient-based optimization: 
Iteration 0:  Log likelihood = -657.45638  
Iteration 1:  Log likelihood = -657.45638  

Computing standard errors ...

Mixed-effects ML regression                          Number of obs    =    392
Group variable: pid                                  Number of groups =     98
                                                     Obs per group:
                                                                  min =      4
                                                                  avg =    4.0
                                                                  max =      4
                                                     Wald chi2(8)     = 668.05
Log likelihood = -657.45638                          Prob &gt; chi2      = 0.0000

------------------------------------------------------------------------------
     contout | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         trt |
     Active  |  -1.429745   .1959578    -7.30   0.000    -1.813815   -1.045675
             |
        site |
          2  |   .6526838   .2761648     2.36   0.018     .1114107    1.193957
          3  |   .5751011   .2484525     2.31   0.021     .0881431    1.062059
          4  |   .9060635   .2962487     3.06   0.002     .3254268      1.4867
             |
        time |
          1  |   .9346939   .1621317     5.77   0.000     .6169216    1.252466
          2  |   2.069388   .1621317    12.76   0.000     1.751615     2.38716
          3  |   2.689796   .1621317    16.59   0.000     2.372024    3.007568
             |
       covar |   .8633823   .0519317    16.63   0.000      .761598    .9651666
       _cons |   14.55194   .3117202    46.68   0.000     13.94098     15.1629
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
pid: Identity                |
                  var(_cons) |   .6013744   .1345595      .3878697    .9324039
-----------------------------+------------------------------------------------
               var(Residual) |   1.288047   .1062364      1.095786    1.514041
------------------------------------------------------------------------------
LR test vs. linear model: chibar2(01) = 46.95         Prob &gt;= chibar2 = 0.0000</code></pre>
<p>In R this the model is coded as</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="continuous-endpoints.html#cb13-1" tabindex="-1"></a>rct <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="continuous-endpoints.html#cb13-2" tabindex="-1"></a>  <span class="fu">lmer</span>(contout <span class="sc">~</span> trt <span class="sc">+</span> site <span class="sc">+</span> time <span class="sc">+</span> covar <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>pid),<span class="at">data=</span>., <span class="at">REML=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="continuous-endpoints.html#cb13-3" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">correlation=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>Linear mixed model fit by maximum likelihood  [&#39;lmerMod&#39;]
Formula: contout ~ trt + site + time + covar + (1 | pid)
   Data: .

     AIC      BIC   logLik deviance df.resid 
  1336.9   1380.6   -657.5   1314.9      381 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.4684 -0.5939  0.0717  0.6466  2.4636 

Random effects:
 Groups   Name        Variance Std.Dev.
 pid      (Intercept) 0.6014   0.7755  
 Residual             1.2880   1.1349  
Number of obs: 392, groups:  pid, 98

Fixed effects:
            Estimate Std. Error t value
(Intercept) 14.55194    0.31172  46.683
trtActive   -1.42975    0.19596  -7.296
site2        0.65268    0.27616   2.363
site3        0.57510    0.24845   2.315
site4        0.90606    0.29625   3.058
time1        0.93469    0.16213   5.765
time2        2.06939    0.16213  12.764
time3        2.68980    0.16213  16.590
covar        0.86338    0.05193  16.625</code></pre>
<p>Note that we need to specify “REML=FALSE” to produce Maximum Likelihood estimates to be consistent with the Stata estimates.</p>
<p>This is clearly not a good model since it assumes that the treatment effect is the same at all timepoints (including baseline). Since we should assume no treatment difference at baseline, the model is clearly wrong. We see this when we plot the model estimates through the “margins” and “marginsplot” procedures in Stata, and the “marginaleffects”-package in R. The “marginaleffects”-package is heavily influenced by Stata.</p>
<!-- Note that the Stata offers the best way to present the marginal estimates through the 'margins' and 'marginsplt' procedures. I have not been able to find R packages that integrates this in a similar consistent way, although the 'margins' R package delivers some of the functionality.   -->
<div class="sourceCode" id="cb15"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb15-1"><a href="continuous-endpoints.html#cb15-1" tabindex="-1"></a><span class="kw">use</span> stata/rct, <span class="kw">clear</span> </span>
<span id="cb15-2"><a href="continuous-endpoints.html#cb15-2" tabindex="-1"></a>mixed contout i.trt i.site i.time covar || pid: </span>
<span id="cb15-3"><a href="continuous-endpoints.html#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="continuous-endpoints.html#cb15-4" tabindex="-1"></a>*Compute the marginal <span class="kw">estimates</span> <span class="kw">by</span> time and treatment</span>
<span id="cb15-5"><a href="continuous-endpoints.html#cb15-5" tabindex="-1"></a></span>
<span id="cb15-6"><a href="continuous-endpoints.html#cb15-6" tabindex="-1"></a>margins time#trt</span>
<span id="cb15-7"><a href="continuous-endpoints.html#cb15-7" tabindex="-1"></a></span>
<span id="cb15-8"><a href="continuous-endpoints.html#cb15-8" tabindex="-1"></a>*Plot the marginal <span class="kw">estimates</span>. Note that the arguments after the <span class="kw">comma</span> is just to prettify the plot.</span>
<span id="cb15-9"><a href="continuous-endpoints.html#cb15-9" tabindex="-1"></a></span>
<span id="cb15-10"><a href="continuous-endpoints.html#cb15-10" tabindex="-1"></a>marginsplot, graphregion(<span class="kw">color</span>(<span class="bn">white</span>)) graphregion(<span class="kw">color</span>(<span class="bn">white</span>)) <span class="bn">plotregion</span>(<span class="kw">color</span>(<span class="bn">white</span>)) <span class="bn">ytitle</span>(<span class="st">&quot;Marginal estimates&quot;</span>) <span class="kw">ylabel</span>(,<span class="bn">nogrid</span>)  <span class="bn">legend</span>(region(<span class="kw">color</span>(<span class="kw">none</span>) lstyle(<span class="kw">none</span>)) <span class="bn">cols</span>(1) <span class="bn">ring</span>(0) bplacement(nwest)) <span class="bn">title</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb15-11"><a href="continuous-endpoints.html#cb15-11" tabindex="-1"></a><span class="kw">graph</span> <span class="kw">export</span> stata/figures/cont_fig1.png, <span class="kw">replace</span> </span></code></pre></div>
<pre><code>(all strata combined)


Performing EM optimization ...

Performing gradient-based optimization: 
Iteration 0:  Log likelihood = -657.45638  
Iteration 1:  Log likelihood = -657.45638  

Computing standard errors ...

Mixed-effects ML regression                          Number of obs    =    392
Group variable: pid                                  Number of groups =     98
                                                     Obs per group:
                                                                  min =      4
                                                                  avg =    4.0
                                                                  max =      4
                                                     Wald chi2(8)     = 668.05
Log likelihood = -657.45638                          Prob &gt; chi2      = 0.0000

------------------------------------------------------------------------------
     contout | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         trt |
     Active  |  -1.429745   .1959578    -7.30   0.000    -1.813815   -1.045675
             |
        site |
          2  |   .6526838   .2761648     2.36   0.018     .1114107    1.193957
          3  |   .5751011   .2484525     2.31   0.021     .0881431    1.062059
          4  |   .9060635   .2962487     3.06   0.002     .3254268      1.4867
             |
        time |
          1  |   .9346939   .1621317     5.77   0.000     .6169216    1.252466
          2  |   2.069388   .1621317    12.76   0.000     1.751615     2.38716
          3  |   2.689796   .1621317    16.59   0.000     2.372024    3.007568
             |
       covar |   .8633823   .0519317    16.63   0.000      .761598    .9651666
       _cons |   14.55194   .3117202    46.68   0.000     13.94098     15.1629
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
pid: Identity                |
                  var(_cons) |   .6013744   .1345595      .3878697    .9324039
-----------------------------+------------------------------------------------
               var(Residual) |   1.288047   .1062364      1.095786    1.514041
------------------------------------------------------------------------------
LR test vs. linear model: chibar2(01) = 46.95         Prob &gt;= chibar2 = 0.0000


Predictive margins                                         Number of obs = 392

Expression: Linear prediction, fixed portion, predict()

------------------------------------------------------------------------------
             |            Delta-method
             |     Margin   std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    time#trt |
  0#Placebo  |   19.12477   .1687953   113.30   0.000     18.79394    19.45561
   0#Active  |   17.69503   .1711009   103.42   0.000     17.35968    18.03038
  1#Placebo  |   20.05947   .1687953   118.84   0.000     19.72863     20.3903
   1#Active  |   18.62972   .1711009   108.88   0.000     18.29437    18.96507
  2#Placebo  |   21.19416   .1687953   125.56   0.000     20.86333    21.52499
   2#Active  |   19.76442   .1711009   115.51   0.000     19.42906    20.09977
  3#Placebo  |   21.81457   .1687953   129.24   0.000     21.48374     22.1454
   3#Active  |   20.38482   .1711009   119.14   0.000     20.04947    20.72018
------------------------------------------------------------------------------


Variables that uniquely identify margins: time trt

(file stata/figures/cont_fig1.png not found)
file stata/figures/cont_fig1.png written in PNG format</code></pre>
<!-- ![Simple mixed model marginal estimates](stata/figures/cont_fig1.pdf) -->
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="continuous-endpoints.html#cb17-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;stata/figures/cont_fig1.png&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-4"></span>
<img src="stata/figures/cont_fig1.png" alt="Simple mixed model marginal plot from Stata" width="360" />
<p class="caption">
Figure 3.1: Simple mixed model marginal plot from Stata
</p>
</div>
<p>We will show how to code this in R below. The code is similar.</p>
</div>
<div id="model-with-treatment-time-interaction" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Model with treatment-time interaction<a href="continuous-endpoints.html#model-with-treatment-time-interaction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A better solution would be to add a treatment-time interaction to the mixed model to loosen the assumption that the treatment effect is equal across time.</p>
<p>In Stata, the model is coded as:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb18-1"><a href="continuous-endpoints.html#cb18-1" tabindex="-1"></a><span class="kw">use</span> stata/rct, <span class="kw">clear</span> </span>
<span id="cb18-2"><a href="continuous-endpoints.html#cb18-2" tabindex="-1"></a>mixed contout i.trt i.time i.trt#i.time i.site covar || pid: </span></code></pre></div>
<pre><code>(all strata combined)


Performing EM optimization ...

Performing gradient-based optimization: 
Iteration 0:  Log likelihood = -603.47362  
Iteration 1:  Log likelihood = -603.47362  

Computing standard errors ...

Mixed-effects ML regression                          Number of obs    =    392
Group variable: pid                                  Number of groups =     98
                                                     Obs per group:
                                                                  min =      4
                                                                  avg =    4.0
                                                                  max =      4
                                                     Wald chi2(11)    = 943.21
Log likelihood = -603.47362                          Prob &gt; chi2      = 0.0000

------------------------------------------------------------------------------
     contout | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         trt |
     Active  |   .1464841   .2563632     0.57   0.568    -.3559785    .6489468
             |
        time |
          1  |      1.516   .1889091     8.03   0.000     1.145745    1.886255
          2  |      3.174   .1889091    16.80   0.000     2.803745    3.544255
          3  |      4.092   .1889091    21.66   0.000     3.721745    4.462255
             |
    trt#time |
   Active#1  |  -1.186833   .2699264    -4.40   0.000    -1.715879   -.6577872
   Active#2  |   -2.25525   .2699264    -8.36   0.000    -2.784296   -1.726204
   Active#3  |  -2.862833   .2699264   -10.61   0.000    -3.391879   -2.333787
             |
        site |
          2  |   .6526838   .2761649     2.36   0.018     .1114106    1.193957
          3  |   .5751011   .2484525     2.31   0.021     .0881431    1.062059
          4  |   .9060635   .2962487     3.06   0.002     .3254267      1.4867
             |
       covar |   .8633823   .0519317    16.63   0.000      .761598    .9651666
       _cons |   13.77991   .3173239    43.43   0.000     13.15796    14.40185
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
pid: Identity                |
                  var(_cons) |   .7003448   .1331889      .4824292    1.016694
-----------------------------+------------------------------------------------
               var(Residual) |   .8921667   .0735847       .758997    1.048702
------------------------------------------------------------------------------
LR test vs. linear model: chibar2(01) = 87.90         Prob &gt;= chibar2 = 0.0000</code></pre>
<p>In R this model is coded as</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="continuous-endpoints.html#cb20-1" tabindex="-1"></a>rct <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="continuous-endpoints.html#cb20-2" tabindex="-1"></a>  <span class="fu">lmer</span>(contout <span class="sc">~</span> trt <span class="sc">+</span> time <span class="sc">+</span> trt<span class="sc">*</span>time <span class="sc">+</span> site <span class="sc">+</span> covar <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>pid),<span class="at">data=</span>., <span class="at">REML=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="continuous-endpoints.html#cb20-3" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">correlation=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>Linear mixed model fit by maximum likelihood  [&#39;lmerMod&#39;]
Formula: contout ~ trt + time + trt * time + site + covar + (1 | pid)
   Data: .

     AIC      BIC   logLik deviance df.resid 
  1234.9   1290.5   -603.5   1206.9      378 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.6736 -0.5555  0.0171  0.6023  2.4871 

Random effects:
 Groups   Name        Variance Std.Dev.
 pid      (Intercept) 0.7003   0.8369  
 Residual             0.8922   0.9445  
Number of obs: 392, groups:  pid, 98

Fixed effects:
                Estimate Std. Error t value
(Intercept)     13.77991    0.31732  43.425
trtActive        0.14648    0.25636   0.571
time1            1.51600    0.18891   8.025
time2            3.17400    0.18891  16.802
time3            4.09200    0.18891  21.661
site2            0.65268    0.27616   2.363
site3            0.57510    0.24845   2.315
site4            0.90606    0.29625   3.058
covar            0.86338    0.05193  16.625
trtActive:time1 -1.18683    0.26993  -4.397
trtActive:time2 -2.25525    0.26993  -8.355
trtActive:time3 -2.86283    0.26993 -10.606</code></pre>
<p>The problem with the results as presented both by Stata and R is that they are difficult to interpret. The solution is to use predictive margins and corresponding marginal plots. First we plot the predictive margins by treatment:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb22-1"><a href="continuous-endpoints.html#cb22-1" tabindex="-1"></a><span class="kw">use</span> stata/rct, <span class="kw">clear</span> </span>
<span id="cb22-2"><a href="continuous-endpoints.html#cb22-2" tabindex="-1"></a><span class="kw">quietly</span> mixed contout i.trt  i.time  i.trt#i.time i.site covar || pid: </span>
<span id="cb22-3"><a href="continuous-endpoints.html#cb22-3" tabindex="-1"></a></span>
<span id="cb22-4"><a href="continuous-endpoints.html#cb22-4" tabindex="-1"></a>*Compute the predictive margins <span class="kw">by</span> time and treatment</span>
<span id="cb22-5"><a href="continuous-endpoints.html#cb22-5" tabindex="-1"></a></span>
<span id="cb22-6"><a href="continuous-endpoints.html#cb22-6" tabindex="-1"></a> margins time#trt</span>
<span id="cb22-7"><a href="continuous-endpoints.html#cb22-7" tabindex="-1"></a></span>
<span id="cb22-8"><a href="continuous-endpoints.html#cb22-8" tabindex="-1"></a>*Plot the predictive margins. Note that the arguments after the <span class="kw">comma</span> is just to prettify the plot.</span>
<span id="cb22-9"><a href="continuous-endpoints.html#cb22-9" tabindex="-1"></a></span>
<span id="cb22-10"><a href="continuous-endpoints.html#cb22-10" tabindex="-1"></a>marginsplot, graphregion(<span class="kw">color</span>(<span class="bn">white</span>)) graphregion(<span class="kw">color</span>(<span class="bn">white</span>)) <span class="bn">plotregion</span>(<span class="kw">color</span>(<span class="bn">white</span>)) <span class="bn">ytitle</span>(<span class="st">&quot;Marginal estimates&quot;</span>) <span class="kw">ylabel</span>(,<span class="bn">nogrid</span>)  <span class="bn">legend</span>(region(<span class="kw">color</span>(<span class="kw">none</span>) lstyle(<span class="kw">none</span>)) <span class="bn">cols</span>(1) <span class="bn">ring</span>(0) bplacement(nwest)) <span class="bn">title</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb22-11"><a href="continuous-endpoints.html#cb22-11" tabindex="-1"></a><span class="kw">graph</span> <span class="kw">export</span> stata/figures/cont_fig2.png, <span class="kw">replace</span> </span></code></pre></div>
<pre><code>(all strata combined)



Predictive margins                                         Number of obs = 392

Expression: Linear prediction, fixed portion, predict()

------------------------------------------------------------------------------
             |            Delta-method
             |     Margin   std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    time#trt |
  0#Placebo  |   18.35274   .1789325   102.57   0.000     18.00204    18.70344
   0#Active  |   18.49923    .182642   101.29   0.000     18.14125     18.8572
  1#Placebo  |   19.86874   .1789325   111.04   0.000     19.51804    20.21944
   1#Active  |   18.82839    .182642   103.09   0.000     18.47042    19.18637
  2#Placebo  |   21.52674   .1789325   120.31   0.000     21.17604    21.87744
   2#Active  |   19.41798    .182642   106.32   0.000        19.06    19.77595
  3#Placebo  |   22.44474   .1789325   125.44   0.000     22.09404    22.79544
   3#Active  |   19.72839    .182642   108.02   0.000     19.37042    20.08637
------------------------------------------------------------------------------


Variables that uniquely identify margins: time trt

file stata/figures/cont_fig2.png written in PNG format</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="continuous-endpoints.html#cb24-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;stata/figures/cont_fig2.png&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-5"></span>
<img src="stata/figures/cont_fig2.png" alt="Margins plot by Stata" width="85%" />
<p class="caption">
Figure 3.2: Margins plot by Stata
</p>
</div>
<p>In R this can be achieved by:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="continuous-endpoints.html#cb25-1" tabindex="-1"></a>mod <span class="ot">&lt;-</span> </span>
<span id="cb25-2"><a href="continuous-endpoints.html#cb25-2" tabindex="-1"></a>  <span class="fu">lmer</span>(contout <span class="sc">~</span> trt <span class="sc">+</span> time <span class="sc">+</span> trt<span class="sc">*</span>time <span class="sc">+</span> site <span class="sc">+</span> covar <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>pid),<span class="at">data=</span>rct, <span class="at">REML=</span><span class="cn">FALSE</span>) </span>
<span id="cb25-3"><a href="continuous-endpoints.html#cb25-3" tabindex="-1"></a></span>
<span id="cb25-4"><a href="continuous-endpoints.html#cb25-4" tabindex="-1"></a>mod <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="continuous-endpoints.html#cb25-5" tabindex="-1"></a>  <span class="fu">avg_predictions</span>(<span class="at">variables =</span> <span class="fu">list</span>(<span class="at">trt =</span> <span class="fu">c</span>(<span class="st">&quot;Active&quot;</span>, <span class="st">&quot;Placebo&quot;</span>), <span class="at">time =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>)) )</span></code></pre></div>
<pre><code>
 time     trt Estimate Std. Error   z Pr(&gt;|z|)   S 2.5 % 97.5 %
    0 Active      18.5      0.183 101   &lt;0.001 Inf  18.1   18.9
    0 Placebo     18.4      0.179 103   &lt;0.001 Inf  18.0   18.7
    1 Active      18.8      0.183 103   &lt;0.001 Inf  18.5   19.2
    1 Placebo     19.9      0.179 111   &lt;0.001 Inf  19.5   20.2
    2 Active      19.4      0.183 106   &lt;0.001 Inf  19.1   19.8
    2 Placebo     21.5      0.179 120   &lt;0.001 Inf  21.2   21.9
    3 Active      19.7      0.183 108   &lt;0.001 Inf  19.4   20.1
    3 Placebo     22.4      0.179 125   &lt;0.001 Inf  22.1   22.8

Columns: trt, time, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="continuous-endpoints.html#cb27-1" tabindex="-1"></a>p <span class="ot">&lt;-</span> mod <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="continuous-endpoints.html#cb27-2" tabindex="-1"></a>  <span class="fu">avg_predictions</span>(<span class="at">variables =</span> <span class="fu">list</span>(<span class="at">trt =</span> <span class="fu">c</span>(<span class="st">&quot;Active&quot;</span>, <span class="st">&quot;Placebo&quot;</span>), <span class="at">time =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>)) ) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="continuous-endpoints.html#cb27-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(time, estimate, <span class="at">color=</span>trt, <span class="at">group=</span>trt)) <span class="sc">+</span></span>
<span id="cb27-4"><a href="continuous-endpoints.html#cb27-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.04</span>)) <span class="sc">+</span></span>
<span id="cb27-5"><a href="continuous-endpoints.html#cb27-5" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb27-6"><a href="continuous-endpoints.html#cb27-6" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high), </span>
<span id="cb27-7"><a href="continuous-endpoints.html#cb27-7" tabindex="-1"></a>                <span class="at">width=</span>.<span class="dv">2</span>,</span>
<span id="cb27-8"><a href="continuous-endpoints.html#cb27-8" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.04</span>)) <span class="sc">+</span> </span>
<span id="cb27-9"><a href="continuous-endpoints.html#cb27-9" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Estimate&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-10"><a href="continuous-endpoints.html#cb27-10" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-11"><a href="continuous-endpoints.html#cb27-11" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb27-12"><a href="continuous-endpoints.html#cb27-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb27-13"><a href="continuous-endpoints.html#cb27-13" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>, <span class="at">name =</span> <span class="st">&quot;Treatment&quot;</span>)</span>
<span id="cb27-14"><a href="continuous-endpoints.html#cb27-14" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="rct-cookbook_files/figure-html/rmixed3plot_02-1.png" width="672" /></p>
<p>From this we can estimate the treatment difference at the different timepoints:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb28-1"><a href="continuous-endpoints.html#cb28-1" tabindex="-1"></a><span class="kw">use</span> stata/rct, <span class="kw">clear</span> </span>
<span id="cb28-2"><a href="continuous-endpoints.html#cb28-2" tabindex="-1"></a><span class="kw">quietly</span> mixed contout i.trt  i.time  i.trt#i.time i.site covar || pid: </span>
<span id="cb28-3"><a href="continuous-endpoints.html#cb28-3" tabindex="-1"></a></span>
<span id="cb28-4"><a href="continuous-endpoints.html#cb28-4" tabindex="-1"></a>*Compute the marginal treatment differences</span>
<span id="cb28-5"><a href="continuous-endpoints.html#cb28-5" tabindex="-1"></a></span>
<span id="cb28-6"><a href="continuous-endpoints.html#cb28-6" tabindex="-1"></a>margins time, <span class="kw">dydx</span>(trt)</span></code></pre></div>
<pre><code>(all strata combined)



Average marginal effects                                   Number of obs = 392

Expression: Linear prediction, fixed portion, predict()
dy/dx wrt:  1.trt

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
0.trt        |  (base outcome)
-------------+----------------------------------------------------------------
1.trt        |
        time |
          0  |   .1464841   .2563632     0.57   0.568    -.3559785    .6489468
          1  |  -1.040349   .2563632    -4.06   0.000    -1.542812   -.5378865
          2  |  -2.108766   .2563632    -8.23   0.000    -2.611229   -1.606303
          3  |  -2.716349   .2563632   -10.60   0.000    -3.218812   -2.213887
------------------------------------------------------------------------------
Note: dy/dx for factor levels is the discrete change from the base level.</code></pre>
<p>This can also be achieved in R by:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="continuous-endpoints.html#cb30-1" tabindex="-1"></a>mod <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="continuous-endpoints.html#cb30-2" tabindex="-1"></a>  <span class="fu">avg_comparisons</span>(<span class="at">variables =</span> <span class="fu">list</span>(<span class="at">trt =</span> <span class="fu">c</span>( <span class="st">&quot;Placebo&quot;</span>, <span class="st">&quot;Active&quot;</span>)), <span class="at">by =</span> <span class="st">&quot;time&quot;</span>)</span></code></pre></div>
<pre><code>
 Term                     Contrast time Estimate Std. Error       z Pr(&gt;|z|)
  trt mean(Active) - mean(Placebo)    0    0.146      0.256   0.571    0.568
  trt mean(Active) - mean(Placebo)    1   -1.040      0.256  -4.058   &lt;0.001
  trt mean(Active) - mean(Placebo)    2   -2.109      0.256  -8.226   &lt;0.001
  trt mean(Active) - mean(Placebo)    3   -2.716      0.256 -10.596   &lt;0.001
    S  2.5 % 97.5 %
  0.8 -0.356  0.649
 14.3 -1.543 -0.538
 52.2 -2.611 -1.606
 84.7 -3.219 -2.214

Columns: term, contrast, time, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted 
Type:  response </code></pre>
</div>
<div id="model-with-treatment-time-interaction-and-baseline-information" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Model with treatment-time interaction and baseline information<a href="continuous-endpoints.html#model-with-treatment-time-interaction-and-baseline-information" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, the above model is correct, and will provide unbiased estimates of the time and treatment specific means, including treatment differences at each timepoint. However, there is one piece of information left out of the model, and this is that we know there is no treatment difference at baseline. Thus, we can and should set this parameter to zero.</p>
<p>In Stata, the model is implemented by using a constraint on the parameter space. This can only be done using -meglm-, which is a generalised version of -mixed-:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb32-1"><a href="continuous-endpoints.html#cb32-1" tabindex="-1"></a><span class="kw">use</span> stata/rct, <span class="kw">clear</span></span>
<span id="cb32-2"><a href="continuous-endpoints.html#cb32-2" tabindex="-1"></a></span>
<span id="cb32-3"><a href="continuous-endpoints.html#cb32-3" tabindex="-1"></a>*Constrain the baseline treatment difference to <span class="kw">be</span> <span class="bn">zero</span> </span>
<span id="cb32-4"><a href="continuous-endpoints.html#cb32-4" tabindex="-1"></a></span>
<span id="cb32-5"><a href="continuous-endpoints.html#cb32-5" tabindex="-1"></a><span class="ot">constraint</span> 1 i1.trt#i0.time = 0 </span>
<span id="cb32-6"><a href="continuous-endpoints.html#cb32-6" tabindex="-1"></a></span>
<span id="cb32-7"><a href="continuous-endpoints.html#cb32-7" tabindex="-1"></a>*Use the <span class="ot">constraint</span> <span class="kw">in</span> the <span class="kw">model</span></span>
<span id="cb32-8"><a href="continuous-endpoints.html#cb32-8" tabindex="-1"></a></span>
<span id="cb32-9"><a href="continuous-endpoints.html#cb32-9" tabindex="-1"></a>meglm contout  i.trt#i.time i.site covar || pid:, constraints(1) </span>
<span id="cb32-10"><a href="continuous-endpoints.html#cb32-10" tabindex="-1"></a><span class="kw">quietly</span> margins time#trt</span>
<span id="cb32-11"><a href="continuous-endpoints.html#cb32-11" tabindex="-1"></a>marginsplot, graphregion(<span class="kw">color</span>(<span class="bn">white</span>)) graphregion(<span class="kw">color</span>(<span class="bn">white</span>)) <span class="bn">plotregion</span>(<span class="kw">color</span>(<span class="bn">white</span>)) <span class="bn">ytitle</span>(<span class="st">&quot;Marginal estimates&quot;</span>) <span class="kw">ylabel</span>(,<span class="bn">nogrid</span>)  <span class="bn">legend</span>(region(<span class="kw">color</span>(<span class="kw">none</span>) lstyle(<span class="kw">none</span>)) <span class="bn">cols</span>(1) <span class="bn">ring</span>(0) bplacement(nwest)) <span class="bn">title</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb32-12"><a href="continuous-endpoints.html#cb32-12" tabindex="-1"></a><span class="kw">graph</span> <span class="kw">export</span> stata/figures/cont_fig2.pdf, <span class="kw">replace</span> </span></code></pre></div>
<pre><code>(all strata combined)



Fitting fixed-effects model:

Iteration 0:  Log likelihood = -647.74846  
Iteration 1:  Log likelihood = -647.58931  
Iteration 2:  Log likelihood = -647.58924  

Refining starting values:

Grid node 0:  Log likelihood = -627.10804

Fitting full model:

Iteration 0:  Log likelihood = -627.10804  
Iteration 1:  Log likelihood = -605.26422  
Iteration 2:  Log likelihood = -603.67119  
Iteration 3:  Log likelihood =  -603.6368  
Iteration 4:  Log likelihood = -603.63676  

Mixed-effects GLM                               Number of obs     =        392
Family: Gaussian
Link:   Identity
Group variable: pid                             Number of groups  =         98

                                                Obs per group:
                                                              min =          4
                                                              avg =        4.0
                                                              max =          4

Integration method: mvaghermite                 Integration pts.  =          7

                                                Wald chi2(10)     =     941.63
Log likelihood = -603.63676                     Prob &gt; chi2       =     0.0000
 ( 1)  [contout]1.trt#0b.time = 0
------------------------------------------------------------------------------
     contout | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    trt#time |
  Placebo#1  |   1.476264   .1757139     8.40   0.000     1.131872    1.820657
  Placebo#2  |   3.134265   .1757139    17.84   0.000     2.789872    3.478658
  Placebo#3  |   4.052264   .1757139    23.06   0.000     3.707872    4.396657
   Active#0  |          0  (omitted)
   Active#1  |   .3705578   .1787521     2.07   0.038     .0202101    .7209055
   Active#2  |    .960141   .1787521     5.37   0.000     .6097933    1.310489
   Active#3  |   1.270558   .1787521     7.11   0.000     .9202101    1.620905
             |
        site |
          2  |   .6561135   .2763683     2.37   0.018     .1144415    1.197785
          3  |   .5871323   .2478014     2.37   0.018     .1014504    1.072814
          4  |   .9130567   .2962843     3.08   0.002     .3323502    1.493763
             |
       covar |    .864888   .0519154    16.66   0.000     .7631356    .9666404
       _cons |   13.83893   .3003121    46.08   0.000     13.25033    14.42753
-------------+----------------------------------------------------------------
pid          |
   var(_cons)|   .7020395   .1335678                      .4835202    1.019315
-------------+----------------------------------------------------------------
var(e.cont~t)|   .8925775   .0736384                      .7593135     1.04923
------------------------------------------------------------------------------



Variables that uniquely identify margins: time trt

file stata/figures/cont_fig2.pdf saved as PDF format</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="continuous-endpoints.html#cb34-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;stata/figures/cont_fig2.pdf&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-6"></span>
<embed src="stata/figures/cont_fig2.pdf" title="Margins plot from Stata" width="85%" type="application/pdf" />
<p class="caption">
Figure 3.3: Margins plot from Stata
</p>
</div>
<p>The estimates of the treatment differences at the different timepoints is then given by:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb35-1"><a href="continuous-endpoints.html#cb35-1" tabindex="-1"></a><span class="kw">use</span> stata/rct, <span class="kw">clear</span> </span>
<span id="cb35-2"><a href="continuous-endpoints.html#cb35-2" tabindex="-1"></a><span class="ot">constraint</span> 1 i1.trt#i0.time = 0  </span>
<span id="cb35-3"><a href="continuous-endpoints.html#cb35-3" tabindex="-1"></a><span class="kw">quietly</span> meglm contout  i.trt#i.time i.site covar || pid:, constraints(1)  </span>
<span id="cb35-4"><a href="continuous-endpoints.html#cb35-4" tabindex="-1"></a>margins time, <span class="kw">dydx</span>(trt)</span></code></pre></div>
<pre><code>(all strata combined)




Average marginal effects                                   Number of obs = 392
Model VCE: OIM

Expression: Marginal predicted mean, predict()
dy/dx wrt:  1.trt

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
0.trt        |  (base outcome)
-------------+----------------------------------------------------------------
1.trt        |
        time |
          0  |          0  (omitted)
          1  |  -1.105707   .2297171    -4.81   0.000    -1.555944   -.6554694
          2  |  -2.174124   .2297171    -9.46   0.000    -2.624361   -1.723886
          3  |  -2.781707   .2297171   -12.11   0.000    -3.231944   -2.331469
------------------------------------------------------------------------------
Note: dy/dx for factor levels is the discrete change from the base level.</code></pre>
<p>The same can be accomplished in R by adding a third treatment level (level at baseline):</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="continuous-endpoints.html#cb37-1" tabindex="-1"></a>rmixed4_2 <span class="ot">&lt;-</span> rct <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="continuous-endpoints.html#cb37-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt2 =</span> trt) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="continuous-endpoints.html#cb37-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt2 =</span> <span class="fu">fct_expand</span>(trt2,<span class="st">&quot;0&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="continuous-endpoints.html#cb37-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt2 =</span> <span class="fu">if_else</span>(time <span class="sc">!=</span> <span class="st">&quot;0&quot;</span>,trt2,<span class="fu">factor</span>(<span class="dv">0</span>) )) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="continuous-endpoints.html#cb37-5" tabindex="-1"></a>  <span class="fu">lmer</span>(contout <span class="sc">~</span> time <span class="sc">+</span>  trt2 <span class="sc">+</span>  trt2<span class="sc">*</span>time <span class="sc">+</span> site <span class="sc">+</span> covar <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>pid),<span class="at">data=</span>., <span class="at">REML=</span><span class="cn">FALSE</span>) </span></code></pre></div>
<pre><code>fixed-effect model matrix is rank deficient so dropping 5 columns / coefficients</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="continuous-endpoints.html#cb39-1" tabindex="-1"></a><span class="fu">summary</span>(rmixed4_2, <span class="at">correlation =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>Linear mixed model fit by maximum likelihood  [&#39;lmerMod&#39;]
Formula: contout ~ time + trt2 + trt2 * time + site + covar + (1 | pid)
   Data: .

     AIC      BIC   logLik deviance df.resid 
  1233.3   1284.9   -603.6   1207.3      379 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.6737 -0.5549  0.0147  0.6183  2.4434 

Random effects:
 Groups   Name        Variance Std.Dev.
 pid      (Intercept) 0.7020   0.8379  
 Residual             0.8926   0.9448  
Number of obs: 392, groups:  pid, 98

Fixed effects:
                 Estimate Std. Error t value
(Intercept)      13.83893    0.30031  46.082
time1             1.47626    0.17567   8.404
time2             3.13426    0.17567  17.842
time3             4.05226    0.17567  23.067
trt2Active       -2.78171    0.22958 -12.116
site2             0.65611    0.27637   2.374
site3             0.58713    0.24780   2.369
site4             0.91306    0.29628   3.082
covar             0.86489    0.05192  16.660
time1:trt2Active  1.67600    0.26999   6.208
time2:trt2Active  0.60758    0.26999   2.250
fit warnings:
fixed-effect model matrix is rank deficient so dropping 5 columns / coefficients</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="continuous-endpoints.html#cb41-1" tabindex="-1"></a>pred <span class="ot">&lt;-</span> rmixed4_2 <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="continuous-endpoints.html#cb41-2" tabindex="-1"></a>  <span class="fu">avg_predictions</span>(<span class="at">variables =</span> <span class="fu">list</span>(<span class="at">trt2 =</span> <span class="fu">c</span>(<span class="st">&quot;Active&quot;</span>, <span class="st">&quot;Placebo&quot;</span>, <span class="st">&quot;0&quot;</span>), <span class="at">time =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>)) ) <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="continuous-endpoints.html#cb41-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(trt2 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> time <span class="sc">!=</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-4"><a href="continuous-endpoints.html#cb41-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(trt2 <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> time <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb41-5"><a href="continuous-endpoints.html#cb41-5" tabindex="-1"></a>pred</span></code></pre></div>
<pre><code>
 time    trt2 Estimate Std. Error   z Pr(&gt;|z|)   S 2.5 % 97.5 %
    0 0           18.4      0.128 144   &lt;0.001 Inf  18.2   18.7
    1 Active      18.8      0.173 109   &lt;0.001 Inf  18.5   19.1
    1 Placebo     19.9      0.170 117   &lt;0.001 Inf  19.6   20.2
    2 Active      19.4      0.173 112   &lt;0.001 Inf  19.0   19.7
    2 Placebo     21.6      0.170 127   &lt;0.001 Inf  21.2   21.9
    3 Active      19.7      0.173 114   &lt;0.001 Inf  19.4   20.0
    3 Placebo     22.5      0.170 132   &lt;0.001 Inf  22.1   22.8

Columns: trt2, time, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
<p>The estimated marginal plot is then given by:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="continuous-endpoints.html#cb43-1" tabindex="-1"></a>p <span class="ot">&lt;-</span> pred <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="continuous-endpoints.html#cb43-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt2 =</span> <span class="fu">if_else</span>(time <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;Active&quot;</span>, trt2)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="continuous-endpoints.html#cb43-3" tabindex="-1"></a>  <span class="fu">bind_rows</span>(pred <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">trt2 =</span> <span class="st">&quot;Placebo&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href="continuous-endpoints.html#cb43-4" tabindex="-1"></a>  <span class="fu">arrange</span>( time, trt2)</span>
<span id="cb43-5"><a href="continuous-endpoints.html#cb43-5" tabindex="-1"></a></span>
<span id="cb43-6"><a href="continuous-endpoints.html#cb43-6" tabindex="-1"></a>p <span class="sc">%&gt;%</span> </span>
<span id="cb43-7"><a href="continuous-endpoints.html#cb43-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(time, estimate, <span class="at">color=</span>trt2, <span class="at">group=</span>trt2)) <span class="sc">+</span></span>
<span id="cb43-8"><a href="continuous-endpoints.html#cb43-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.04</span>)) <span class="sc">+</span></span>
<span id="cb43-9"><a href="continuous-endpoints.html#cb43-9" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb43-10"><a href="continuous-endpoints.html#cb43-10" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high), </span>
<span id="cb43-11"><a href="continuous-endpoints.html#cb43-11" tabindex="-1"></a>                <span class="at">width=</span>.<span class="dv">2</span>,</span>
<span id="cb43-12"><a href="continuous-endpoints.html#cb43-12" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.04</span>)) <span class="sc">+</span> </span>
<span id="cb43-13"><a href="continuous-endpoints.html#cb43-13" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Estimate&quot;</span>) <span class="sc">+</span></span>
<span id="cb43-14"><a href="continuous-endpoints.html#cb43-14" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span></span>
<span id="cb43-15"><a href="continuous-endpoints.html#cb43-15" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb43-16"><a href="continuous-endpoints.html#cb43-16" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb43-17"><a href="continuous-endpoints.html#cb43-17" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>, <span class="at">name =</span> <span class="st">&quot;Treatment&quot;</span>)</span></code></pre></div>
<p><img src="rct-cookbook_files/figure-html/rmixed4plot_03-1.png" width="672" /></p>
<p>Note that the Stata and R output gives identical results, which is good!</p>
<!-- ## Change from baseline -->
<!-- Sometimes the outcome measure as defined in the protocol is some variant of change from baseline. Doing analyses on the change from baseline variable is not recommended, as explained brilliantly here in the "Biostatistics for Biomedical Research" by Frank Harrell: [What's Wrong with Change in General](https://hbiostat.org/bbr/change#sec-change-gen). But sometimes the investigators are insistent on using a change measure, or we are bound by the protocol. But there is a way around this. Instead of computing the change from baseline before modelling this endpoint we can do it after modelling the raw measure, using predictions from the model. And then we can present the change from baseline in each group, while keeping the treatment effect estimate from the model.  -->
<!-- In R this is again done using the excellent "marginaleffects"-package.  -->
<!-- ```{r rmixed_04_bl, warning=FALSE} -->
<!-- pred_bl2 <- rmixed4_2 %>%  -->
<!--   predictions(newdata = datagrid(trt2 = c("Active", "Placebo", "0"),  -->
<!--                                                   time = c("0", "3"),  -->
<!--                                                   pid = data$pid)) %>%  -->
<!--     filter(!(trt2 == 0 & time != 0)) %>%  -->
<!--     filter(!(trt2 != 0 & time == 0)) %>%  -->
<!--   group_by(pid) %>%  -->
<!--   mutate(bl = if_else(time == 0, estimate, NA), -->
<!--          bl = max(bl, na.rm = TRUE)) %>% -->
<!--   ungroup %>%  -->
<!--   mutate(chg = estimate - bl)  -->
<!-- pred_bl3 <- rmixed4_2 %>%  -->
<!--   predictions(newdata = datagrid(trt2 = c("Active", "Placebo", "0"),  -->
<!--                                                   time = c("0", "3"), pid= data$pid)) -->
<!--   test <- comparisons(rmixed4_2,  -->
<!--                           variables = "time",  -->
<!--                           newdata = datagrid(trt2 = c("Active", "Placebo", "0"),  -->
<!--                                                   time = c("0", "3"))) -->
<!-- library(nlme) -->
<!--   rmixed4_3 <- rct %>% -->
<!--     mutate(time2 = as.numeric(time)) %>% -->
<!--   mutate(trt2 = trt) %>% -->
<!--     mutate(trt2 = fct_expand(trt2,"0")) %>% -->
<!--   mutate(trt2 = if_else(time != "0",trt2,factor(0) )) %>% -->
<!--  #   filter(time != 0) %>%  -->
<!--   gls(contout ~ time +  trt2 +  trt2*time + site + covar + contbl,data=., correlation = corExp(form =~ time2))  -->
<!--   rmixed4_3 -->
<!-- ``` -->
<!-- # Splines -->
<!-- Sometimes the data collection is not limited to visits, or the visits are not at exact timepoints. E.g. a one-year visit might have a visit window of 40 to 64 weeks. The resulting data could be anywhere in this interval, and the heterogeneity could have an impact on the results. Other trials capture data non-regularly, e.g. whenever the participant is at the hospital for any reason.  -->
<!-- In these trials it would still be interesting to see the development over time. A solution in these situations is to use splines.  -->
<!-- # Adjusting for baseline -->

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dichotomous-endpoints.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["rct-cookbook.pdf", "rct-cookbook.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
