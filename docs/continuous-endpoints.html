<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Continuous endpoints | Analyzing RCTs: A Cookbook</title>
  <meta name="description" content="The idea of this book is to capture some of the standard statistical analysis methods for randomised controlled trials" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Continuous endpoints | Analyzing RCTs: A Cookbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The idea of this book is to capture some of the standard statistical analysis methods for randomised controlled trials" />
  <meta name="github-repo" content="icostatistics/rct-cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Continuous endpoints | Analyzing RCTs: A Cookbook" />
  
  <meta name="twitter:description" content="The idea of this book is to capture some of the standard statistical analysis methods for randomised controlled trials" />
  

<meta name="author" content="Inge Christoffer Olsen" />


<meta name="date" content="2019-08-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html">
<link rel="next" href="dichotomous-endpoints.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#structure-of-the-book"><i class="fa fa-check"></i><b>1.1</b> Structure of the book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.2</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#trial-flow"><i class="fa fa-check"></i><b>2.1</b> Trial Flow</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#simulated-dataset"><i class="fa fa-check"></i><b>2.2</b> Simulated dataset</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html"><i class="fa fa-check"></i><b>3</b> Continuous endpoints</a><ul>
<li class="chapter" data-level="3.1" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#single-follow-up"><i class="fa fa-check"></i><b>3.1</b> Single follow-up</a><ul>
<li class="chapter" data-level="3.1.1" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#stata-code"><i class="fa fa-check"></i><b>3.1.1</b> Stata code</a></li>
<li class="chapter" data-level="3.1.2" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#r-code"><i class="fa fa-check"></i><b>3.1.2</b> R code</a></li>
<li class="chapter" data-level="3.1.3" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#reporting"><i class="fa fa-check"></i><b>3.1.3</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#repeated-follow-up"><i class="fa fa-check"></i><b>3.2</b> Repeated follow-up</a><ul>
<li class="chapter" data-level="3.2.1" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#simple-model"><i class="fa fa-check"></i><b>3.2.1</b> Simple model</a></li>
<li class="chapter" data-level="3.2.2" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#model-with-treatment-time-interaction"><i class="fa fa-check"></i><b>3.2.2</b> Model with treatment-time interaction</a></li>
<li class="chapter" data-level="3.2.3" data-path="continuous-endpoints.html"><a href="continuous-endpoints.html#model-with-treatment-time-interaction-and-baseline-information"><i class="fa fa-check"></i><b>3.2.3</b> Model with treatment-time interaction and baseline information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html"><i class="fa fa-check"></i><b>4</b> Dichotomous endpoints</a><ul>
<li class="chapter" data-level="4.1" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html#single-follow-up-1"><i class="fa fa-check"></i><b>4.1</b> Single follow-up</a><ul>
<li class="chapter" data-level="4.1.1" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html#stata-code-1"><i class="fa fa-check"></i><b>4.1.1</b> Stata code</a></li>
<li class="chapter" data-level="4.1.2" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html#r-code-1"><i class="fa fa-check"></i><b>4.1.2</b> R code</a></li>
<li class="chapter" data-level="4.1.3" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html#reporting-1"><i class="fa fa-check"></i><b>4.1.3</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html#repeated-follow-up-1"><i class="fa fa-check"></i><b>4.2</b> Repeated follow-up</a></li>
<li class="chapter" data-level="4.3" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html#treatment-time-interaction-model"><i class="fa fa-check"></i><b>4.3</b> Treatment-time interaction model</a><ul>
<li class="chapter" data-level="4.3.1" data-path="dichotomous-endpoints.html"><a href="dichotomous-endpoints.html#reporting-2"><i class="fa fa-check"></i><b>4.3.1</b> Reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="time-to-event-analyses.html"><a href="time-to-event-analyses.html"><i class="fa fa-check"></i><b>5</b> Time to event analyses</a></li>
<li class="chapter" data-level="6" data-path="sample-size-calculations.html"><a href="sample-size-calculations.html"><i class="fa fa-check"></i><b>6</b> Sample size calculations</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analyzing RCTs: A Cookbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="continuous-endpoints" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Continuous endpoints</h1>
<div id="single-follow-up" class="section level2">
<h2><span class="header-section-number">3.1</span> Single follow-up</h2>
<p>When the outcome consists of a single follow-up assessment of the continuous endpoint, the main method I use is Analysis of Covariance. According to the EMAs <a href="http://www.ema.europa.eu/docs/en_GB/document_library/Scientific_guideline/2015/03/WC500184923.pdf">Guideline on adjustment for baseline covariates in clinical trials</a> we should adjust for site in multicentre trial, any stratification factors in the randomisation in addition to pre-specified covariates with evidence of strong or moderate association between the covariate and the primary outcome measure. Usually this also means the baseline observation of the outcome. In our simulated data set this means to adjust for <code>site</code>, <code>contbl</code> and <code>covar</code> variables. In this example we define that the primary outcome is the continuous outcome at time 3.</p>
<div id="stata-code" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Stata code</h3>
<pre class="stata"><code>use &quot;stata/rct&quot;, clear 
regress contout i.trt i.site covar contbl if time==3</code></pre>
<pre><code>## 
## . use &quot;stata/rct&quot;, cle(all strata combined)
## 
## . regress contout i.trt i.site covar contbl if time==3
## 
##       Source |       SS           df       MS      Number of obs   =        98
## -------------+----------------------------------   F(6, 91)        =     67.55
##        Model |  454.530038         6  75.7550064   Prob &gt; F        =    0.0000
##     Residual |  102.049964        91  1.12142818   R-squared       =    0.8166
## -------------+----------------------------------   Adj R-squared   =    0.8046
##        Total |  556.580002        97  5.73793817   Root MSE        =     1.059
## 
## ------------------------------------------------------------------------------
##      contout |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##          trt |
##      Active  |  -2.768593   .2162162   -12.80   0.000    -3.198079   -2.339106
##              |
##         site |
##           2  |   .0464146   .3171924     0.15   0.884    -.5836491    .6764783
##           3  |    .194252   .2832692     0.69   0.495    -.3684276    .7569315
##           4  |   .7040756   .3356689     2.10   0.039     .0373106    1.370841
##              |
##        covar |   .5580744   .0882877     6.32   0.000     .3827017    .7334471
##       contbl |   .3812488   .0813377     4.69   0.000     .2196815    .5428161
##        _cons |   12.60568   1.165712    10.81   0.000     10.29013    14.92122
## ------------------------------------------------------------------------------
## 
## .</code></pre>
<p>Note that we here looked at the outcome at time 3 as the primary outcome. It does not matter if we use this or the change from baseline to time 3, due to the baseline adjustment:</p>
<pre class="stata"><code>use stata/rct, clear 
gen diff = contout - contbl 
regress diff i.trt i.site covar contbl if time==3</code></pre>
<pre><code>## 
## . use stata/rct, cle(all strata combined)
## 
## . gen diff = contout - contbl 
## 
## . regress diff i.trt i.site covar contbl if time==3
## 
##       Source |       SS           df       MS      Number of obs   =        98
## -------------+----------------------------------   F(6, 91)        =     40.55
##        Model |  272.859876         6   45.476646   Prob &gt; F        =    0.0000
##     Residual |  102.049964        91  1.12142818   R-squared       =    0.7278
## -------------+----------------------------------   Adj R-squared   =    0.7099
##        Total |   374.90984        97   3.8650499   Root MSE        =     1.059
## 
## ------------------------------------------------------------------------------
##         diff |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##          trt |
##      Active  |  -2.768593   .2162162   -12.80   0.000    -3.198079   -2.339106
##              |
##         site |
##           2  |   .0464146   .3171924     0.15   0.884    -.5836491    .6764783
##           3  |    .194252   .2832692     0.69   0.495    -.3684276    .7569315
##           4  |   .7040756   .3356689     2.10   0.039     .0373106    1.370841
##              |
##        covar |   .5580744   .0882877     6.32   0.000     .3827017    .7334471
##       contbl |  -.6187512   .0813377    -7.61   0.000    -.7803185   -.4571839
##        _cons |   12.60568   1.165712    10.81   0.000     10.29013    14.92122
## ------------------------------------------------------------------------------
## 
## .</code></pre>
<p>We see that the only difference is that the baseline parameter estimate shifts with one unit.</p>
</div>
<div id="r-code" class="section level3">
<h3><span class="header-section-number">3.1.2</span> R code</h3>
<pre class="sourceCode r"><code class="sourceCode r">rct &lt;-<span class="st"> </span><span class="kw">read_dta</span>(<span class="st">&quot;stata/rct.dta&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">modify_at</span>(<span class="kw">c</span>(<span class="st">&quot;trt&quot;</span>,<span class="st">&quot;catout&quot;</span>), haven<span class="op">::</span>as_factor, <span class="dt">levels =</span> <span class="st">&quot;labels&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">modify_at</span>(<span class="kw">c</span>(<span class="st">&quot;site&quot;</span>,<span class="st">&quot;time&quot;</span>), haven<span class="op">::</span>as_factor)
rct <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(time<span class="op">==</span><span class="dv">3</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lm</span>(contout <span class="op">~</span><span class="st"> </span>trt <span class="op">+</span><span class="st"> </span>site <span class="op">+</span><span class="st"> </span>covar <span class="op">+</span><span class="st"> </span>contbl, <span class="dt">data=</span>.) <span class="op">%&gt;%</span>
<span class="st">  </span>summary</code></pre>
<pre><code>## 
## Call:
## lm(formula = contout ~ trt + site + covar + contbl, data = .)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.35594 -0.68326  0.00278  0.73595  1.98465 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 12.60568    1.16571  10.814  &lt; 2e-16 ***
## trtActive   -2.76859    0.21622 -12.805  &lt; 2e-16 ***
## site2        0.04641    0.31719   0.146   0.8840    
## site3        0.19425    0.28327   0.686   0.4946    
## site4        0.70408    0.33567   2.098   0.0387 *  
## covar        0.55807    0.08829   6.321 9.46e-09 ***
## contbl       0.38125    0.08134   4.687 9.68e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.059 on 91 degrees of freedom
## Multiple R-squared:  0.8166, Adjusted R-squared:  0.8046 
## F-statistic: 67.55 on 6 and 91 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>We see that the parameter estimates are identical.</p>
</div>
<div id="reporting" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Reporting</h3>
<p>According to the <a href="consort-statement.org">CONSORT Statement</a> item 17a:
&gt; For each outcome, study results should be reported as a summary of the outcome in each group (for example, the number of participants with or without the event and the denominators, or the mean and standard deviation of measurements), together with the contrast between the groups, known as the effect size.</p>
<p>For the single follow-up we present the mean and standard deviaiton for the outcome in addition to the effect size at follow-up (time 3). There is some coding to get the format right, but the nice thing is that the table could be pasted directly into the article. There are many ways to program this, the below example is one way.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Two functions to produce the mean (sd) and est (lci to uci) output--------------------</span>
get_meansd &lt;-<span class="st"> </span><span class="cf">function</span>(m, s, <span class="dt">d=</span><span class="dv">2</span>){
  <span class="kw">paste</span>(<span class="kw">round</span>(m, <span class="dt">digits=</span>d),<span class="st">&quot; (&quot;</span>,<span class="kw">round</span>(s,<span class="dt">digits=</span>d),<span class="st">&quot;)&quot;</span>)
}
get_estci &lt;-<span class="st"> </span><span class="cf">function</span>(e, l, u, <span class="dt">d=</span><span class="dv">2</span>){
  <span class="kw">paste</span>(<span class="kw">round</span>(e, <span class="dt">digits=</span>d), <span class="st">&quot; (&quot;</span>, <span class="kw">round</span>(l, <span class="dt">digits=</span>d), <span class="st">&quot; to &quot;</span>, <span class="kw">round</span>(u, <span class="dt">digits=</span>d),<span class="st">&quot;)&quot;</span>)
}

<span class="co"># Compile the summary measures---------------------------------------------------------</span>
single_cont_sum &lt;-<span class="st"> </span>rct <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(trt) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(time<span class="op">==</span><span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(contout, trt) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise_all</span>(<span class="kw">list</span>(<span class="op">~</span><span class="kw">mean</span>(.),<span class="op">~</span><span class="kw">sd</span>(.))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">txt1=</span><span class="kw">get_meansd</span>(mean,sd)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(trt,txt1) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(<span class="dt">key=</span>trt,<span class="dt">value=</span>txt1)

<span class="co"># Compile the estimates --------------------------------------------------------------</span>
single_cont_est &lt;-<span class="st"> </span>rct <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(time<span class="op">==</span><span class="dv">3</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lm</span>(contout <span class="op">~</span><span class="st"> </span>trt <span class="op">+</span><span class="st"> </span>site <span class="op">+</span><span class="st"> </span>covar <span class="op">+</span><span class="st"> </span>contbl, <span class="dt">data=</span>.) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int=</span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(term<span class="op">==</span><span class="st">&quot;trtActive&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">txt2=</span><span class="kw">get_estci</span>(estimate,conf.low,conf.high)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(term,txt2)

<span class="co"># Combine and produce the table -----------------------------------------------------</span>
single_cont_sum <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bind_cols</span>(single_cont_est) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">txt=</span><span class="st">&quot;Outcome at time 3, mean (sd)&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(txt,Active, Placebo, txt2) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable</span>(<span class="dt">col.names=</span><span class="kw">c</span>(<span class="st">&quot;Outcome&quot;</span>, <span class="st">&quot;Active&quot;</span>, <span class="st">&quot;Placebo&quot;</span>, <span class="st">&quot;Effect size with 95% confidence limits&quot;</span>))</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left;">
Outcome
</th>
<th style="text-align:left;">
Active
</th>
<th style="text-align:left;">
Placebo
</th>
<th style="text-align:left;">
Effect size with 95% confidence limits
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Outcome at time 3, mean (sd)
</td>
<td style="text-align:left;">
19.88 ( 2.05 )
</td>
<td style="text-align:left;">
22.3 ( 2.09 )
</td>
<td style="text-align:left;">
-2.77 ( -3.2 to -2.34 )
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="repeated-follow-up" class="section level2">
<h2><span class="header-section-number">3.2</span> Repeated follow-up</h2>
<p>When the measurements are repeated, I usually use mixed models to model the data. The challenge with mixed models is that the effect size can be estimated in several ways, depending on the model specification.</p>
<div id="simple-model" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Simple model</h3>
<p>The simplest model is a model with random intercept and treatment, time and other baseline covariates as fixed effects.</p>
<p><span class="math display">\[ Y_{ij} =  \mu_j + A_i + \mu_{trt} + \mu_{strat} + a_1 X_1 +  \epsilon_{ij} \]</span></p>
<p>where <span class="math inline">\(Y_{ij}\)</span> is the contiuous outcome for individual <span class="math inline">\(i\)</span> at time <span class="math inline">\(j\)</span>, <span class="math inline">\(\mu_j\)</span> is the overall mean at time <span class="math inline">\(j\)</span>, <span class="math inline">\(A_i\)</span> is the random intercept for individual <span class="math inline">\(i\)</span>, <span class="math inline">\(\mu_{trt}\)</span> is the mean treatment effect, <span class="math inline">\(\mu_{strat}\)</span> is the mean effect of strata, <span class="math inline">\(a_1\)</span> is the slope parameter of baseline covariate <span class="math inline">\(X_1\)</span>, and <span class="math inline">\(\epsilon_{ij}\)</span> is the residual. The expression is sloppy, but should be readable.</p>
<p>In Stata, this model is coded as</p>
<pre class="stata"><code>use stata/rct, clear 
mixed contout i.trt i.site i.time covar || pid: </code></pre>
<pre><code>## 
## . use stata/rct, cle(all strata combined)
## 
## . mixed contout i.trt i.site i.time covar || pid: 
## 
## Performing EM optimization: 
## 
## Performing gradient-based optimization: 
## 
## Iteration 0:   log likelihood = -657.45638  
## Iteration 1:   log likelihood = -657.45638  
## 
## Computing standard errors:
## 
## Mixed-effects ML regression                     Number of obs     =        392
## Group variable: pid                             Number of groups  =         98
## 
##                                                 Obs per group:
##                                                               min =          4
##                                                               avg =        4.0
##                                                               max =          4
## 
##                                                 Wald chi2(8)      =     668.05
## Log likelihood = -657.45638                     Prob &gt; chi2       =     0.0000
## 
## ------------------------------------------------------------------------------
##      contout |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##          trt |
##      Active  |  -1.429745   .1959578    -7.30   0.000    -1.813815   -1.045675
##              |
##         site |
##           2  |   .6526838   .2761648     2.36   0.018     .1114107    1.193957
##           3  |   .5751011   .2484525     2.31   0.021     .0881431    1.062059
##           4  |   .9060635   .2962487     3.06   0.002     .3254268      1.4867
##              |
##         time |
##           1  |   .9346939   .1621317     5.77   0.000     .6169216    1.252466
##           2  |   2.069388   .1621317    12.76   0.000     1.751615     2.38716
##           3  |   2.689796   .1621317    16.59   0.000     2.372024    3.007568
##              |
##        covar |   .8633823   .0519317    16.63   0.000      .761598    .9651666
##        _cons |   14.55194   .3117202    46.68   0.000     13.94098     15.1629
## ------------------------------------------------------------------------------
## 
## ------------------------------------------------------------------------------
##   Random-effects Parameters  |   Estimate   Std. Err.     [95% Conf. Interval]
## -----------------------------+------------------------------------------------
## pid: Identity                |
##                   var(_cons) |   .6013744   .1345595      .3878697    .9324039
## -----------------------------+------------------------------------------------
##                var(Residual) |   1.288047   .1062364      1.095786    1.514041
## ------------------------------------------------------------------------------
## LR test vs. linear model: chibar2(01) = 46.95         Prob &gt;= chibar2 = 0.0000
## 
## .</code></pre>
<p>In R this the model is coded as</p>
<pre class="sourceCode r"><code class="sourceCode r">rct <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lmer</span>(contout <span class="op">~</span><span class="st"> </span>trt <span class="op">+</span><span class="st"> </span>site <span class="op">+</span><span class="st"> </span>time <span class="op">+</span><span class="st"> </span>covar <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>pid),<span class="dt">data=</span>., <span class="dt">REML=</span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summary</span>(<span class="dt">correlation=</span><span class="ot">FALSE</span>)</code></pre>
<pre><code>## Linear mixed model fit by maximum likelihood  [&#39;lmerMod&#39;]
## Formula: contout ~ trt + site + time + covar + (1 | pid)
##    Data: .
## 
##      AIC      BIC   logLik deviance df.resid 
##   1336.9   1380.6   -657.5   1314.9      381 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.4684 -0.5939  0.0717  0.6466  2.4636 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  pid      (Intercept) 0.6014   0.7755  
##  Residual             1.2880   1.1349  
## Number of obs: 392, groups:  pid, 98
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) 14.55194    0.31172  46.683
## trtActive   -1.42975    0.19596  -7.296
## site2        0.65268    0.27616   2.363
## site3        0.57510    0.24845   2.315
## site4        0.90606    0.29625   3.058
## time1        0.93469    0.16213   5.765
## time2        2.06939    0.16213  12.764
## time3        2.68980    0.16213  16.590
## covar        0.86338    0.05193  16.625</code></pre>
<p>Note that we need to specify “REML=FALSE” to produce Maximum Likelihood estimates to be consistent with the Stata estimates.</p>
<p>This is clearly not a good model since it assumes that the treatment effect is the same at all timepoints (including baseline). Since we should assume no treatment difference at baseline, the model is clearly wrong. We see this when we plot the model estimates through the “margins” and “marginsplot” procedures in Stata, and the “margins”-package in R. The “margins”-package is a port from Stata.</p>
<!-- Note that the Stata offers the best way to present the marginal estimates through the 'margins' and 'marginsplt' procedures. I have not been able to find R packages that integrates this in a similar consistent way, although the 'margins' R package delivers some of the functionality.   -->
<pre class="stata"><code>use stata/rct, clear 
mixed contout i.trt i.site i.time covar || pid: 

*Compute the marginal estimates by time and treatment

margins time#trt

*Plot the marginal estimates. Note that the arguments after the comma is just to prettify the plot.

marginsplot, graphregion(color(white)) graphregion(color(white)) plotregion(color(white)) ytitle(&quot;Marginal estimates&quot;) ylabel(,nogrid)  legend(region(color(none) lstyle(none)) cols(1) ring(0) bplacement(nwest)) title(&quot;&quot;)
graph export stata/figures/cont_fig1.pdf, replace </code></pre>
<pre><code>## 
## . use stata/rct, cle(all strata combined)
## 
## . mixed contout i.trt i.site i.time covar || pid: 
## 
## Performing EM optimization: 
## 
## Performing gradient-based optimization: 
## 
## Iteration 0:   log likelihood = -657.45638  
## Iteration 1:   log likelihood = -657.45638  
## 
## Computing standard errors:
## 
## Mixed-effects ML regression                     Number of obs     =        392
## Group variable: pid                             Number of groups  =         98
## 
##                                                 Obs per group:
##                                                               min =          4
##                                                               avg =        4.0
##                                                               max =          4
## 
##                                                 Wald chi2(8)      =     668.05
## Log likelihood = -657.45638                     Prob &gt; chi2       =     0.0000
## 
## ------------------------------------------------------------------------------
##      contout |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##          trt |
##      Active  |  -1.429745   .1959578    -7.30   0.000    -1.813815   -1.045675
##              |
##         site |
##           2  |   .6526838   .2761648     2.36   0.018     .1114107    1.193957
##           3  |   .5751011   .2484525     2.31   0.021     .0881431    1.062059
##           4  |   .9060635   .2962487     3.06   0.002     .3254268      1.4867
##              |
##         time |
##           1  |   .9346939   .1621317     5.77   0.000     .6169216    1.252466
##           2  |   2.069388   .1621317    12.76   0.000     1.751615     2.38716
##           3  |   2.689796   .1621317    16.59   0.000     2.372024    3.007568
##              |
##        covar |   .8633823   .0519317    16.63   0.000      .761598    .9651666
##        _cons |   14.55194   .3117202    46.68   0.000     13.94098     15.1629
## ------------------------------------------------------------------------------
## 
## ------------------------------------------------------------------------------
##   Random-effects Parameters  |   Estimate   Std. Err.     [95% Conf. Interval]
## -----------------------------+------------------------------------------------
## pid: Identity                |
##                   var(_cons) |   .6013744   .1345595      .3878697    .9324039
## -----------------------------+------------------------------------------------
##                var(Residual) |   1.288047   .1062364      1.095786    1.514041
## ------------------------------------------------------------------------------
## LR test vs. linear model: chibar2(01) = 46.95         Prob &gt;= chibar2 = 0.0000
## 
## . 
## . *Compute the marginal estimates by time and treatment
## 
## . 
## . margins time#trt
## 
## Predictive margins                              Number of obs     =        392
## 
## Expression   : Linear prediction, fixed portion, predict()
## 
## ------------------------------------------------------------------------------
##              |            Delta-method
##              |     Margin   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##     time#trt |
##   0#Placebo  |   19.12477   .1687953   113.30   0.000     18.79394    19.45561
##    0#Active  |   17.69503   .1711009   103.42   0.000     17.35968    18.03038
##   1#Placebo  |   20.05947   .1687953   118.84   0.000     19.72863     20.3903
##    1#Active  |   18.62972   .1711009   108.88   0.000     18.29437    18.96507
##   2#Placebo  |   21.19416   .1687953   125.56   0.000     20.86333    21.52499
##    2#Active  |   19.76442   .1711009   115.51   0.000     19.42906    20.09977
##   3#Placebo  |   21.81457   .1687953   129.24   0.000     21.48374     22.1454
##    3#Active  |   20.38482   .1711009   119.14   0.000     20.04947    20.72018
## ------------------------------------------------------------------------------
## 
## . 
## . *Plot the marginal estimates. Note that the arguments after the comma is just
## &gt;  to prettify the plot.
## 
## . 
## . marginsplot, graphregion(color(white)) graphregion(color(white)) plotregion(c
## &gt; olor(white)) ytitle(&quot;Marginal estimates&quot;) ylabel(,nogrid)  legend(region(colo
## &gt; r(none) lstyle(none)) cols(1) ring(0) bplacement(nwest)) title(&quot;&quot;)
## 
##   Variables that uniquely identify margins: time trt
## 
## . graph export stata/figures/cont_fig1.pdf, replace 
## (file stata/figures/cont_fig1.pdf written in PDF format)
## 
## .</code></pre>
<!-- ![Simple mixed model marginal estimates](stata/figures/cont_fig1.pdf) -->
<pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;stata/figures/cont_fig1.pdf&quot;</span>)</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-4"></span>
<img src="stata/figures/cont_fig1.pdf" alt="Simple mixed model marginal plot from Stata" width="85%" />
<p class="caption">
Figure 3.1: Simple mixed model marginal plot from Stata
</p>
</div>
<p>We will show how to code this in R below. The code is similar.</p>
</div>
<div id="model-with-treatment-time-interaction" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Model with treatment-time interaction</h3>
<p>A better solution would be to add a treatment-time interaction to the mixed model to loosen the assumption that the treatment effect is equal across time.</p>
<p>In Stata, the model is coded as:</p>
<pre class="stata"><code>use stata/rct, clear 
mixed contout i.trt i.time i.trt#i.time i.site covar || pid: </code></pre>
<pre><code>## 
## . use stata/rct, cle(all strata combined)
## 
## . mixed contout i.trt i.time i.trt#i.time i.site covar || pid: 
## 
## Performing EM optimization: 
## 
## Performing gradient-based optimization: 
## 
## Iteration 0:   log likelihood = -603.47362  
## Iteration 1:   log likelihood = -603.47362  
## 
## Computing standard errors:
## 
## Mixed-effects ML regression                     Number of obs     =        392
## Group variable: pid                             Number of groups  =         98
## 
##                                                 Obs per group:
##                                                               min =          4
##                                                               avg =        4.0
##                                                               max =          4
## 
##                                                 Wald chi2(11)     =     943.21
## Log likelihood = -603.47362                     Prob &gt; chi2       =     0.0000
## 
## ------------------------------------------------------------------------------
##      contout |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##          trt |
##      Active  |   .1464841   .2563632     0.57   0.568    -.3559785    .6489468
##              |
##         time |
##           1  |      1.516   .1889091     8.03   0.000     1.145745    1.886255
##           2  |      3.174   .1889091    16.80   0.000     2.803745    3.544255
##           3  |      4.092   .1889091    21.66   0.000     3.721745    4.462255
##              |
##     trt#time |
##    Active#1  |  -1.186833   .2699264    -4.40   0.000    -1.715879   -.6577872
##    Active#2  |   -2.25525   .2699264    -8.36   0.000    -2.784296   -1.726204
##    Active#3  |  -2.862833   .2699264   -10.61   0.000    -3.391879   -2.333787
##              |
##         site |
##           2  |   .6526838   .2761649     2.36   0.018     .1114106    1.193957
##           3  |   .5751011   .2484525     2.31   0.021     .0881431    1.062059
##           4  |   .9060635   .2962487     3.06   0.002     .3254267      1.4867
##              |
##        covar |   .8633823   .0519317    16.63   0.000      .761598    .9651666
##        _cons |   13.77991   .3173239    43.43   0.000     13.15796    14.40185
## ------------------------------------------------------------------------------
## 
## ------------------------------------------------------------------------------
##   Random-effects Parameters  |   Estimate   Std. Err.     [95% Conf. Interval]
## -----------------------------+------------------------------------------------
## pid: Identity                |
##                   var(_cons) |   .7003448   .1331889      .4824292    1.016694
## -----------------------------+------------------------------------------------
##                var(Residual) |   .8921667   .0735847       .758997    1.048702
## ------------------------------------------------------------------------------
## LR test vs. linear model: chibar2(01) = 87.90         Prob &gt;= chibar2 = 0.0000
## 
## .</code></pre>
<p>In R this model is coded as</p>
<pre class="sourceCode r"><code class="sourceCode r">rct <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lmer</span>(contout <span class="op">~</span><span class="st"> </span>trt <span class="op">+</span><span class="st"> </span>time <span class="op">+</span><span class="st"> </span>trt<span class="op">*</span>time <span class="op">+</span><span class="st"> </span>site <span class="op">+</span><span class="st"> </span>covar <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>pid),<span class="dt">data=</span>., <span class="dt">REML=</span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summary</span>(<span class="dt">correlation=</span><span class="ot">FALSE</span>)</code></pre>
<pre><code>## Linear mixed model fit by maximum likelihood  [&#39;lmerMod&#39;]
## Formula: contout ~ trt + time + trt * time + site + covar + (1 | pid)
##    Data: .
## 
##      AIC      BIC   logLik deviance df.resid 
##   1234.9   1290.5   -603.5   1206.9      378 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.6736 -0.5555  0.0171  0.6023  2.4871 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  pid      (Intercept) 0.7003   0.8369  
##  Residual             0.8922   0.9445  
## Number of obs: 392, groups:  pid, 98
## 
## Fixed effects:
##                 Estimate Std. Error t value
## (Intercept)     13.77991    0.31732  43.425
## trtActive        0.14648    0.25636   0.571
## time1            1.51600    0.18891   8.025
## time2            3.17400    0.18891  16.802
## time3            4.09200    0.18891  21.661
## site2            0.65268    0.27616   2.363
## site3            0.57510    0.24845   2.315
## site4            0.90606    0.29625   3.058
## covar            0.86338    0.05193  16.625
## trtActive:time1 -1.18683    0.26993  -4.397
## trtActive:time2 -2.25525    0.26993  -8.355
## trtActive:time3 -2.86283    0.26993 -10.606</code></pre>
<p>The problem with the results as presented both by Stata and R is that they are difficult to interpret. The solution is to use predictive margins and corresponding marginal plots. First we plot the predictive margins by treatment:</p>
<pre class="stata"><code>use stata/rct, clear 
quietly mixed contout i.trt  i.time  i.trt#i.time i.site covar || pid: 

*Compute the predictive margins by time and treatment

 margins time#trt

*Plot the predictive margins. Note that the arguments after the comma is just to prettify the plot.

marginsplot, graphregion(color(white)) graphregion(color(white)) plotregion(color(white)) ytitle(&quot;Marginal estimates&quot;) ylabel(,nogrid)  legend(region(color(none) lstyle(none)) cols(1) ring(0) bplacement(nwest)) title(&quot;&quot;)
graph export stata/figures/cont_fig2.pdf, replace </code></pre>
<pre><code>## 
## . use stata/rct, cle(all strata combined)
## 
## . quietly mixed contout i.trt  i.time  i.trt#i.time i.site covar || pid: 
## 
## . 
## . *Compute the predictive margins by time and treatment
## 
## . 
## .  margins time#trt
## 
## Predictive margins                              Number of obs     =        392
## 
## Expression   : Linear prediction, fixed portion, predict()
## 
## ------------------------------------------------------------------------------
##              |            Delta-method
##              |     Margin   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##     time#trt |
##   0#Placebo  |   18.35274   .1789325   102.57   0.000     18.00204    18.70344
##    0#Active  |   18.49923    .182642   101.29   0.000     18.14125     18.8572
##   1#Placebo  |   19.86874   .1789325   111.04   0.000     19.51804    20.21944
##    1#Active  |   18.82839    .182642   103.09   0.000     18.47042    19.18637
##   2#Placebo  |   21.52674   .1789325   120.31   0.000     21.17604    21.87744
##    2#Active  |   19.41798    .182642   106.32   0.000        19.06    19.77595
##   3#Placebo  |   22.44474   .1789325   125.44   0.000     22.09404    22.79544
##    3#Active  |   19.72839    .182642   108.02   0.000     19.37042    20.08637
## ------------------------------------------------------------------------------
## 
## . 
## . *Plot the predictive margins. Note that the arguments after the comma is just
## &gt;  to prettify the plot.
## 
## . 
## . marginsplot, graphregion(color(white)) graphregion(color(white)) plotregion(c
## &gt; olor(white)) ytitle(&quot;Marginal estimates&quot;) ylabel(,nogrid)  legend(region(colo
## &gt; r(none) lstyle(none)) cols(1) ring(0) bplacement(nwest)) title(&quot;&quot;)
## 
##   Variables that uniquely identify margins: time trt
## 
## . graph export stata/figures/cont_fig2.pdf, replace 
## (file stata/figures/cont_fig2.pdf written in PDF format)
## 
## .</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;stata/figures/cont_fig2.pdf&quot;</span>)</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-5"></span>
<img src="stata/figures/cont_fig2.pdf" alt="Margins plot by Stata" width="85%" />
<p class="caption">
Figure 3.2: Margins plot by Stata
</p>
</div>
<p>From this we can estimate the treatment difference at the different timepoints:</p>
<pre class="stata"><code>use stata/rct, clear 
quietly mixed contout i.trt  i.time  i.trt#i.time i.site covar || pid: 

*Compute the marginal treatment differences

margins time, dydx(trt)</code></pre>
<pre><code>## 
## . use stata/rct, cle(all strata combined)
## 
## . quietly mixed contout i.trt  i.time  i.trt#i.time i.site covar || pid: 
## 
## . 
## . *Compute the marginal treatment differences
## 
## . 
## . margins time, dydx(trt)
## 
## Average marginal effects                        Number of obs     =        392
## 
## Expression   : Linear prediction, fixed portion, predict()
## dy/dx w.r.t. : 1.trt
## 
## ------------------------------------------------------------------------------
##              |            Delta-method
##              |      dy/dx   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
## 0.trt        |  (base outcome)
## -------------+----------------------------------------------------------------
## 1.trt        |
##         time |
##           0  |   .1464841   .2563632     0.57   0.568    -.3559785    .6489468
##           1  |  -1.040349   .2563632    -4.06   0.000    -1.542812   -.5378865
##           2  |  -2.108766   .2563632    -8.23   0.000    -2.611229   -1.606303
##           3  |  -2.716349   .2563632   -10.60   0.000    -3.218812   -2.213887
## ------------------------------------------------------------------------------
## Note: dy/dx for factor levels is the discrete change from the base level.
## 
## .</code></pre>
<p>This can also be achieved in R by:</p>
<pre class="sourceCode r"><code class="sourceCode r">trt_margins &lt;-<span class="st"> </span>rct <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lmer</span>(contout <span class="op">~</span><span class="st"> </span>trt <span class="op">+</span><span class="st"> </span>time <span class="op">+</span><span class="st"> </span>trt<span class="op">*</span>time <span class="op">+</span><span class="st"> </span>site <span class="op">+</span><span class="st"> </span>covar <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>pid),<span class="dt">data=</span>., <span class="dt">REML=</span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">margins</span>(<span class="dt">model =</span> .,<span class="dt">variables =</span> <span class="st">&quot;trt&quot;</span>, <span class="dt">at=</span> <span class="kw">list</span>(<span class="dt">time=</span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>)), <span class="dt">vce =</span> <span class="st">&quot;delta&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summary</span>() 

<span class="kw">as_tibble</span>(trt_margins)</code></pre>
<pre><code>## # A tibble: 4 x 8
##   factor    time     AME    SE       z        p  lower  upper
##   &lt;chr&gt;     &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 trtActive 0      0.146 0.256   0.571 5.68e- 1 -0.356  0.649
## 2 trtActive 1     -1.04  0.256  -4.06  4.95e- 5 -1.54  -0.538
## 3 trtActive 2     -2.11  0.256  -8.23  1.94e-16 -2.61  -1.61 
## 4 trtActive 3     -2.72  0.256 -10.6   3.12e-26 -3.22  -2.21</code></pre>
<p>A corresponding estimated marginal means plot can be made in R by using the emmeans package.</p>
<pre class="sourceCode r"><code class="sourceCode r"> rct <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lmer</span>(contout <span class="op">~</span><span class="st"> </span>trt <span class="op">+</span><span class="st"> </span>time <span class="op">+</span><span class="st"> </span>trt<span class="op">*</span>time <span class="op">+</span><span class="st"> </span>site <span class="op">+</span><span class="st"> </span>covar <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>pid),<span class="dt">data=</span>., <span class="dt">REML=</span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ref_grid</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">emmeans</span>( <span class="op">~</span><span class="st"> </span>trt <span class="op">|</span><span class="st"> </span>time) <span class="op">%&gt;%</span>
<span class="st">  </span>tidy</code></pre>
<pre><code>## # A tibble: 8 x 7
##   trt     time  estimate std.error    df conf.low conf.high
##   &lt;fct&gt;   &lt;fct&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 Placebo 0         18.4     0.185  256.     18.1      18.8
## 2 Active  0         18.6     0.189  256.     18.2      18.9
## 3 Placebo 1         19.9     0.185  256.     19.6      20.3
## 4 Active  1         18.9     0.189  256.     18.5      19.3
## 5 Placebo 2         21.6     0.185  256.     21.2      22.0
## 6 Active  2         19.5     0.189  256.     19.1      19.9
## 7 Placebo 3         22.5     0.185  256.     22.1      22.9
## 8 Active  3         19.8     0.189  256.     19.4      20.2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">rct <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lmer</span>(contout <span class="op">~</span><span class="st"> </span>trt <span class="op">+</span><span class="st"> </span>time <span class="op">+</span><span class="st"> </span>trt<span class="op">*</span>time <span class="op">+</span><span class="st"> </span>site <span class="op">+</span><span class="st"> </span>covar <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>pid),<span class="dt">data=</span>., <span class="dt">REML=</span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ref_grid</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">emmeans</span>( <span class="op">~</span><span class="st"> </span>trt <span class="op">|</span><span class="st"> </span>time) <span class="op">%&gt;%</span>
<span class="st">  </span>tidy <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(time, estimate, <span class="dt">color=</span>trt, <span class="dt">group=</span>trt)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="fl">0.04</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high), 
                <span class="dt">width=</span>.<span class="dv">2</span>,
                <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="fl">0.04</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Estimate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="kw">c</span>(<span class="fl">0.1</span>,<span class="fl">0.9</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>, <span class="dt">name =</span> <span class="st">&quot;Treatment&quot;</span>) </code></pre>
<p><img src="rct-cookbook_files/figure-html/rmixed3plot_02-1.png" width="672" /></p>
<p>Note that Stata’s predictive margins and R’s estimated marginal means has slightly different interpretations, especially when the data are not balanced. R can also produce predictive margins using the prediction-package, but there is a challenge with the confidence intervals. The best way to handle this is by bootstrapping, see example below.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(boot)

 fpred &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data, indices){
   d &lt;-<span class="st"> </span>data[indices,]
   fit &lt;-<span class="st"> </span><span class="kw">lmer</span>(formula, <span class="dt">data =</span> d, <span class="dt">REML=</span>F)
   pred &lt;-<span class="st"> </span><span class="kw">prediction</span>(fit,<span class="dt">data =</span> d, <span class="dt">at =</span> <span class="kw">list</span>(<span class="dt">trt =</span> <span class="kw">c</span>(<span class="st">&quot;Active&quot;</span>, <span class="st">&quot;Placebo&quot;</span>), <span class="dt">time =</span> <span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">     </span>as_tibble <span class="op">%&gt;%</span>
<span class="st">     </span><span class="kw">group_by</span>(trt, time) <span class="op">%&gt;%</span>
<span class="st">     </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(fitted)) <span class="op">%&gt;%</span>
<span class="st">     </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">     </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">paste0</span>(trt,time)) <span class="op">%&gt;%</span>
<span class="st">     </span><span class="kw">select</span>(name,mean) <span class="op">%&gt;%</span>
<span class="st">     </span><span class="kw">spread</span>(name,mean) <span class="op">%&gt;%</span>
<span class="st">     </span>as_vector
   <span class="kw">return</span>(pred)
 }
 
 data &lt;-<span class="st"> </span>rct
 result &lt;-<span class="st"> </span><span class="kw">boot</span>(<span class="dt">data =</span> data, 
                <span class="dt">statistic =</span> fpred, 
                <span class="dt">R =</span> <span class="dv">10000</span>, 
                <span class="dt">formula =</span> contout <span class="op">~</span><span class="st"> </span>trt <span class="op">+</span><span class="st"> </span>time <span class="op">+</span><span class="st"> </span>trt<span class="op">*</span>time <span class="op">+</span><span class="st"> </span>site <span class="op">+</span><span class="st"> </span>covar <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>pid),
                <span class="dt">parallel =</span> <span class="st">&quot;multicore&quot;</span>,
                <span class="dt">ncpus =</span> <span class="dv">4</span>) <span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) 
 
 result <span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">select</span>(<span class="op">-</span>bias) <span class="op">%&gt;%</span>
<span class="st">   </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
conf.low
</th>
<th style="text-align:right;">
conf.high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Active0
</td>
<td style="text-align:right;">
18.499
</td>
<td style="text-align:right;">
0.161
</td>
<td style="text-align:right;">
18.186
</td>
<td style="text-align:right;">
18.810
</td>
</tr>
<tr>
<td style="text-align:left;">
Active1
</td>
<td style="text-align:right;">
18.828
</td>
<td style="text-align:right;">
0.153
</td>
<td style="text-align:right;">
18.524
</td>
<td style="text-align:right;">
19.121
</td>
</tr>
<tr>
<td style="text-align:left;">
Active2
</td>
<td style="text-align:right;">
19.418
</td>
<td style="text-align:right;">
0.189
</td>
<td style="text-align:right;">
19.040
</td>
<td style="text-align:right;">
19.783
</td>
</tr>
<tr>
<td style="text-align:left;">
Active3
</td>
<td style="text-align:right;">
19.728
</td>
<td style="text-align:right;">
0.169
</td>
<td style="text-align:right;">
19.396
</td>
<td style="text-align:right;">
20.048
</td>
</tr>
<tr>
<td style="text-align:left;">
Placebo0
</td>
<td style="text-align:right;">
18.353
</td>
<td style="text-align:right;">
0.193
</td>
<td style="text-align:right;">
17.966
</td>
<td style="text-align:right;">
18.727
</td>
</tr>
<tr>
<td style="text-align:left;">
Placebo1
</td>
<td style="text-align:right;">
19.869
</td>
<td style="text-align:right;">
0.168
</td>
<td style="text-align:right;">
19.542
</td>
<td style="text-align:right;">
20.201
</td>
</tr>
<tr>
<td style="text-align:left;">
Placebo2
</td>
<td style="text-align:right;">
21.527
</td>
<td style="text-align:right;">
0.182
</td>
<td style="text-align:right;">
21.172
</td>
<td style="text-align:right;">
21.889
</td>
</tr>
<tr>
<td style="text-align:left;">
Placebo3
</td>
<td style="text-align:right;">
22.445
</td>
<td style="text-align:right;">
0.151
</td>
<td style="text-align:right;">
22.142
</td>
<td style="text-align:right;">
22.741
</td>
</tr>
</tbody>
</table>
<p>We note that the estimates are the same as for the Stata marginal means, but that the standard errors are smaller. Thus, in this case it seems that the standard error computed using the delta method is conservative.</p>
</div>
<div id="model-with-treatment-time-interaction-and-baseline-information" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Model with treatment-time interaction and baseline information</h3>
<p>Now, the above model is correct, and will provide unbiased estimates of the time and treatment specific means, including treatment differences at each timepoint. However, there is one piece of information left out of the model, and this is that we know there is no treatment difference at baseline. Thus, we can and should set this parameter to zero.</p>
<p>In Stata, the model is implemented by using a constraint on the parameter space. This can only be done using -meglm-, which is a generalised version of -mixed-:</p>
<pre class="stata"><code>use stata/rct, clear

*Constrain the baseline treatment difference to be zero 

constraint 1 i1.trt#i0.time = 0 

*Use the constraint in the model

meglm contout  i.trt#i.time i.site covar || pid:, constraints(1) 
quietly margins time#trt
marginsplot, graphregion(color(white)) graphregion(color(white)) plotregion(color(white)) ytitle(&quot;Marginal estimates&quot;) ylabel(,nogrid)  legend(region(color(none) lstyle(none)) cols(1) ring(0) bplacement(nwest)) title(&quot;&quot;)
graph export stata/figures/cont_fig2.pdf, replace </code></pre>
<pre><code>## 
## . use stata/rct, cl(all strata combined)
## 
## . 
## . *Constrain the baseline treatment difference to be zero 
## 
## . 
## . constraint 1 i1.trt#i0.time = 0 
## 
## . 
## . *Use the constraint in the model
## 
## . 
## . meglm contout  i.trt#i.time i.site covar || pid:, constraints(1) 
## 
## Fitting fixed-effects model:
## 
## Iteration 0:   log likelihood = -647.74846  
## Iteration 1:   log likelihood = -647.58931  
## Iteration 2:   log likelihood = -647.58924  
## 
## Refining starting values:
## 
## Grid node 0:   log likelihood = -627.10804
## 
## Fitting full model:
## 
## Iteration 0:   log likelihood = -627.10804  
## Iteration 1:   log likelihood = -605.26422  
## Iteration 2:   log likelihood = -603.67119  
## Iteration 3:   log likelihood =  -603.6368  
## Iteration 4:   log likelihood = -603.63676  
## 
## Mixed-effects GLM                               Number of obs     =        392
## Family:                Gaussian
## Link:                  identity
## Group variable:             pid                 Number of groups  =         98
## 
##                                                 Obs per group:
##                                                               min =          4
##                                                               avg =        4.0
##                                                               max =          4
## 
## Integration method: mvaghermite                 Integration pts.  =          7
## 
##                                                 Wald chi2(10)     =     941.63
## Log likelihood = -603.63676                     Prob &gt; chi2       =     0.0000
##  ( 1)  [contout]1.trt#0b.time = 0
## ------------------------------------------------------------------------------
##      contout |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
##     trt#time |
##   Placebo#1  |   1.476264   .1757139     8.40   0.000     1.131872    1.820657
##   Placebo#2  |   3.134265   .1757139    17.84   0.000     2.789872    3.478658
##   Placebo#3  |   4.052264   .1757139    23.06   0.000     3.707872    4.396657
##    Active#0  |          0  (omitted)
##    Active#1  |   .3705578   .1787521     2.07   0.038     .0202101    .7209055
##    Active#2  |    .960141   .1787521     5.37   0.000     .6097933    1.310489
##    Active#3  |   1.270558   .1787521     7.11   0.000     .9202101    1.620905
##              |
##         site |
##           2  |   .6561135   .2763683     2.37   0.018     .1144415    1.197785
##           3  |   .5871323   .2478014     2.37   0.018     .1014504    1.072814
##           4  |   .9130567   .2962843     3.08   0.002     .3323502    1.493763
##              |
##        covar |    .864888   .0519154    16.66   0.000     .7631356    .9666404
##        _cons |   13.83893   .3003121    46.08   0.000     13.25033    14.42753
## -------------+----------------------------------------------------------------
## pid          |
##    var(_cons)|   .7020395   .1335678                      .4835202    1.019315
## -------------+----------------------------------------------------------------
## var(e.cont~t)|   .8925775   .0736384                      .7593135     1.04923
## ------------------------------------------------------------------------------
## 
## . quietly margins time#trt
## 
## . marginsplot, graphregion(color(white)) graphregion(color(white)) plotregion(c
## &gt; olor(white)) ytitle(&quot;Marginal estimates&quot;) ylabel(,nogrid)  legend(region(colo
## &gt; r(none) lstyle(none)) cols(1) ring(0) bplacement(nwest)) title(&quot;&quot;)
## 
##   Variables that uniquely identify margins: time trt
## 
## . graph export stata/figures/cont_fig2.pdf, replace 
## (file stata/figures/cont_fig2.pdf written in PDF format)
## 
## .</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;stata/figures/cont_fig2.pdf&quot;</span>)</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-6"></span>
<img src="stata/figures/cont_fig2.pdf" alt="Margins plot from Stata" width="85%" />
<p class="caption">
Figure 3.3: Margins plot from Stata
</p>
</div>
<p>The estimates of the treatment differences at the different timepoints is then given by:</p>
<pre class="stata"><code>use stata/rct, clear 
constraint 1 i1.trt#i0.time = 0  
quietly meglm contout  i.trt#i.time i.site covar || pid:, constraints(1)  
margins time, dydx(trt)</code></pre>
<pre><code>## 
## . use stata/rct, cle(all strata combined)
## 
## . constraint 1 i1.trt#i0.time = 0  
## 
## . quietly meglm contout  i.trt#i.time i.site covar || pid:, constraints(1)  
## 
## . margins time, dydx(trt)
## 
## Average marginal effects                        Number of obs     =        392
## Model VCE    : OIM
## 
## Expression   : Marginal predicted mean, predict()
## dy/dx w.r.t. : 1.trt
## 
## ------------------------------------------------------------------------------
##              |            Delta-method
##              |      dy/dx   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
## -------------+----------------------------------------------------------------
## 0.trt        |  (base outcome)
## -------------+----------------------------------------------------------------
## 1.trt        |
##         time |
##           0  |          0  (omitted)
##           1  |  -1.105707   .2297171    -4.81   0.000    -1.555944   -.6554694
##           2  |  -2.174124   .2297171    -9.46   0.000    -2.624361   -1.723886
##           3  |  -2.781707   .2297171   -12.11   0.000    -3.231944   -2.331469
## ------------------------------------------------------------------------------
## Note: dy/dx for factor levels is the discrete change from the base level.
## 
## .</code></pre>
<p>The same can be accomplished in R by adding a third treatment level (level at baseline):</p>
<pre class="sourceCode r"><code class="sourceCode r">rmixed4_<span class="dv">2</span> &lt;-<span class="st"> </span>rct <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">trt2 =</span> <span class="kw">if_else</span>(time <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="dv">0</span>,<span class="kw">as.numeric</span>(trt))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">trt2f =</span> <span class="kw">factor</span>(trt2)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lmer</span>(contout <span class="op">~</span><span class="st"> </span>time <span class="op">+</span><span class="st"> </span>trt2f <span class="op">+</span><span class="st">  </span>trt2f<span class="op">*</span>time <span class="op">+</span><span class="st"> </span>site <span class="op">+</span><span class="st"> </span>covar <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>pid),<span class="dt">data=</span>., <span class="dt">REML=</span><span class="ot">FALSE</span>) </code></pre>
<pre><code>## fixed-effect model matrix is rank deficient so dropping 5 columns / coefficients</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(rmixed4_<span class="dv">2</span>)</code></pre>
<pre><code>## Linear mixed model fit by maximum likelihood  [&#39;lmerMod&#39;]
## Formula: contout ~ time + trt2f + trt2f * time + site + covar + (1 | pid)
##    Data: .
## 
##      AIC      BIC   logLik deviance df.resid 
##   1233.3   1284.9   -603.6   1207.3      379 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.6737 -0.5549  0.0147  0.6183  2.4434 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  pid      (Intercept) 0.7020   0.8379  
##  Residual             0.8926   0.9448  
## Number of obs: 392, groups:  pid, 98
## 
## Fixed effects:
##              Estimate Std. Error t value
## (Intercept)  13.83893    0.30031  46.082
## time1         0.37056    0.17871   2.074
## time2         0.96014    0.17871   5.373
## time3         1.27056    0.17871   7.110
## trt2f1        2.78171    0.22958  12.116
## site2         0.65611    0.27637   2.374
## site3         0.58713    0.24780   2.369
## site4         0.91306    0.29628   3.082
## covar         0.86489    0.05192  16.660
## time1:trt2f1 -1.67600    0.26999  -6.208
## time2:trt2f1 -0.60758    0.26999  -2.250
## 
## Correlation of Fixed Effects:
##             (Intr) time1  time2  time3  trt2f1 site2  site3  site4  covar 
## time1       -0.140                                                        
## time2       -0.140  0.418                                                 
## time3       -0.140  0.418  0.418                                          
## trt2f1      -0.046 -0.202 -0.202 -0.655                                   
## site2       -0.223 -0.009 -0.009 -0.009  0.013                            
## site3       -0.343 -0.034 -0.034 -0.034  0.053  0.452                     
## site4       -0.345 -0.017 -0.017 -0.017  0.026  0.363  0.408              
## covar       -0.770 -0.021 -0.021 -0.021  0.031 -0.178 -0.078  0.012       
## tim1:trt2f1  0.000 -0.385  0.000  0.385 -0.588  0.000  0.000  0.000  0.000
## tim2:trt2f1  0.000  0.000 -0.385  0.385 -0.588  0.000  0.000  0.000  0.000
##             tm1:21
## time1             
## time2             
## time3             
## trt2f1            
## site2             
## site3             
## site4             
## covar             
## tim1:trt2f1       
## tim2:trt2f1  0.500
## fit warnings:
## fixed-effect model matrix is rank deficient so dropping 5 columns / coefficients</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">rmixed4_<span class="dv">2</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">margins</span>(<span class="dt">model =</span> .,<span class="dt">variables =</span> <span class="st">&quot;trt2f&quot;</span>, <span class="dt">at=</span> <span class="kw">list</span>(<span class="dt">time=</span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>)), <span class="dt">vce =</span> <span class="st">&quot;delta&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summary</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(z))</code></pre>
<pre><code>##   factor time      AME        SE         z            p    lower    upper
## 1 trt2f1    1 1.105707 0.2295836  4.816139 1.463627e-06 0.655731 1.555682
## 2 trt2f1    2 2.174124 0.2295836  9.469854 2.802343e-21 1.724148 2.624099
## 3 trt2f1    3 2.781707 0.2295836 12.116311 8.656902e-34 2.331731 3.231682</code></pre>
<p>The estimated marginal plot is given by:</p>
<pre class="sourceCode r"><code class="sourceCode r">plotobject &lt;-<span class="st"> </span>
<span class="st">  </span>rct <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">trt2 =</span> trt) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">trt2 =</span> <span class="kw">fct_expand</span>(trt2,<span class="st">&quot;0&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">trt2 =</span> <span class="kw">if_else</span>(time <span class="op">!=</span><span class="st"> &quot;0&quot;</span>,trt2,<span class="kw">factor</span>(<span class="dv">0</span>) )) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lmer</span>(contout <span class="op">~</span><span class="st"> </span>time <span class="op">+</span><span class="st">  </span>trt2 <span class="op">+</span><span class="st">  </span>trt2<span class="op">*</span>time <span class="op">+</span><span class="st"> </span>site <span class="op">+</span><span class="st"> </span>covar <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>pid),<span class="dt">data=</span>., <span class="dt">REML=</span><span class="ot">FALSE</span>)  <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ref_grid</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">emmeans</span>( <span class="op">~</span><span class="st"> </span>trt2 <span class="op">|</span><span class="st"> </span>time) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>((trt2 <span class="op">!=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>time <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>)   <span class="op">|</span><span class="st"> </span>(trt2<span class="op">==</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>time <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_rows</span>(.,<span class="kw">mutate</span>(<span class="kw">filter</span>(.,trt2<span class="op">==</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>time<span class="op">==</span><span class="dv">0</span>),<span class="dt">trt2 =</span> <span class="kw">fct_recode</span>(trt2,<span class="st">&quot;Placebo&quot;</span>=<span class="st">&quot;0&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">trt2=</span> <span class="kw">fct_recode</span>(trt2,<span class="st">&quot;Active&quot;</span> =<span class="st"> &quot;0&quot;</span>)) </code></pre>
<pre><code>## fixed-effect model matrix is rank deficient so dropping 5 columns / coefficients
## fixed-effect model matrix is rank deficient so dropping 5 columns / coefficients</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">plotobject <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(time, estimate, <span class="dt">color=</span>trt2, <span class="dt">group=</span>trt2)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="fl">0.04</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Estimate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high), 
                <span class="dt">width=</span><span class="fl">0.1</span>,
                <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="fl">0.04</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="kw">c</span>(<span class="fl">0.1</span>,<span class="fl">0.9</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>, <span class="dt">name=</span><span class="st">&quot;Treatment&quot;</span>)</code></pre>
<p><img src="rct-cookbook_files/figure-html/rmixed4plot_02-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dichotomous-endpoints.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["rct-cookbook.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
